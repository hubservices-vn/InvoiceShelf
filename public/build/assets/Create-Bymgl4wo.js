import{ad as ce,av as pe,aw as ge,F as _e,E as ve,v as fe,L as Ie,e as ye,M as Be,f as c,k as _,j as be,Q as $e,z as Ve,W as he,r,o as T,m as x,w as l,a as o,b as U,l as t,p as F,t as N,K as A,J as Se,q as we,g as P,h as Ce,I as Me,ah as Te}from"./main-DmfySYkn.js";import{_ as xe}from"./ItemUnitModal-BNE5GCV1.js";import{_ as Ue}from"./CategoryModal-BBkGjLI0.js";import{u as Fe}from"./category-uu6siVCP.js";import{_ as Ne}from"./CreateCustomFields-DscmJu8O.js";import"./dynamic-import-helper-BheWnx7M.js";const G="customFields",Re={__name:"Create",setup(Pe){ce();const j=Fe(),a=pe(),k=ge(),b=_e(),Y=ve(),{t:p}=fe.useI18n(),$=Ie(),H=ye(),J=Be(),I=c(!1),V=c([]),v=c(null),h=c(null),y=c(!1),S=c(Y.selectedCompanySettings.tax_per_item);let s=c(!1);a.$reset(),te();function O(e,n,u,f){h.value=f.name,v.value=n}function W(){v.value=null,h.value=null,I.value=!0}function K(){b.openModal({title:p("settings.category.add_category"),componentName:"CategoryModal",size:"sm",refreshData:E,data:{type:"item"}})}const z=c([]),w=c(!1);async function E(e=void 0){var u;w.value=!0;const n=await j.fetchCategories({search:e,type:"item"});n.data.data.length&&(z.value=((u=n.data)==null?void 0:u.data)||[]),w.value=!1}const C=_({get:()=>a.currentItem.price/100,set:e=>{a.currentItem.price=Math.round(e*100)}}),L=_({get:()=>{var e,n;return(n=(e=a==null?void 0:a.currentItem)==null?void 0:e.taxes)==null?void 0:n.map(u=>{if(u)return{...u,tax_type_id:u.id,tax_name:u.name+" ("+u.percent+"%)"}})},set:e=>{a.currentItem.taxes=e}}),B=_(()=>$.name==="items.edit"),q=_(()=>B.value?p("items.edit_item"):p("items.new_item")),Q=_(()=>k.taxTypes.map(e=>({...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}))),X=_(()=>S.value==="YES"),Z=_(()=>({currentItem:{name:{required:P.withMessage(p("validation.required"),Ce),minLength:P.withMessage(p("validation.name_min_length",{count:2}),Me(2))},description:{maxLength:P.withMessage(p("validation.description_maxlength"),Te(65e3))}}})),m=be(Z,a,{$scope:G});async function ee(){b.openModal({title:p("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function te(){if(s.value=!0,await a.fetchItemUnits({limit:"all"}),J.hasAbilities($e.VIEW_TAX_TYPE)&&await k.fetchTaxTypes({limit:"all"}),B.value){let e=$.params.id;await a.fetchItem(e),a.currentItem.tax_per_item===1?S.value="YES":S.value="NO"}s.value=!1}async function ae(){if(m.value.$touch(),m.value.$invalid)return!1;y.value=!0;try{let n={id:$.params.id,...a.currentItem};a.currentItem&&a.currentItem.taxes&&(n.taxes=a.currentItem.taxes.map(d=>({tax_type_id:d.tax_type_id,amount:C.value*d.percent,percent:d.percent,name:d.name,collective_tax:0})));const f=await(B.value?a.updateItem:a.addItem)(n);if(f.data.data&&(v.value||I.value)){let d=new FormData;v.value&&d.append("item_image",JSON.stringify({name:h.value,data:v.value})),I.value&&d.append("is_item_image_removed",I.value),await a.updateItemImage(f.data.data.id,d),v.value=null,I.value=!1}y.value=!1,H.push("/admin/items"),e()}catch{y.value=!1;return}function e(){b.closeModal(),setTimeout(()=>{a.resetCurrentItem(),b.$reset(),m.value.$reset()},300)}}return Ve(()=>a.currentItem.image_url,e=>{e&&(V.value=[{image:e}])}),he(()=>{E()}),(e,n)=>{const u=r("BaseBreadcrumbItem"),f=r("BaseBreadcrumb"),d=r("BasePageHeader"),ne=r("BaseInput"),g=r("BaseInputGroup"),M=r("BaseIcon"),D=r("BaseSelectAction"),oe=r("BaseTreeSelect"),le=r("BaseMoney"),R=r("BaseMultiselect"),se=r("BaseTextarea"),ie=r("BaseFileUploader"),re=r("BaseButton"),ue=r("BaseInputGrid"),me=r("BaseCard"),de=r("BasePage");return T(),x(de,null,{default:l(()=>[o(d,{title:q.value},{default:l(()=>[o(f,null,{default:l(()=>[o(u,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),o(u,{title:e.$t("items.item",2),to:"/admin/items"},null,8,["title"]),o(u,{title:q.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(xe),o(Ue),U("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:we(ae,["prevent"])},[o(me,{class:"w-full"},{default:l(()=>[o(ue,{layout:"one-column"},{default:l(()=>[o(g,{label:e.$t("items.name"),"content-loading":t(s),required:"",error:t(m).currentItem.name.$error&&t(m).currentItem.name.$errors[0].$message},{default:l(()=>[o(ne,{modelValue:t(a).currentItem.name,"onUpdate:modelValue":n[0]||(n[0]=i=>t(a).currentItem.name=i),"content-loading":t(s),invalid:t(m).currentItem.name.$error,onInput:n[1]||(n[1]=i=>t(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(g,{label:e.$t("expenses.category"),"content-loading":t(s)},{default:l(()=>[o(oe,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:e.$t("expenses.categories.select_a_category"),"parent-prop":"parent_id",options:z.value,"content-loading":t(s),loading:w.value,modelValue:t(a).currentItem.category_id,"onUpdate:modelValue":n[2]||(n[2]=i=>t(a).currentItem.category_id=i)},{"after-list":l(()=>[o(D,{onClick:K},{default:l(()=>[o(M,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),F(" "+N(e.$t("settings.category.add_new_category")),1)]),_:1})]),_:1},8,["placeholder","options","content-loading","loading","modelValue"])]),_:1},8,["label","content-loading"]),o(g,{label:e.$t("items.price"),"content-loading":t(s)},{default:l(()=>[o(le,{modelValue:C.value,"onUpdate:modelValue":n[3]||(n[3]=i=>C.value=i),"content-loading":t(s)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(g,{"content-loading":t(s),label:e.$t("items.unit")},{default:l(()=>[o(R,{modelValue:t(a).currentItem.unit_id,"onUpdate:modelValue":n[4]||(n[4]=i=>t(a).currentItem.unit_id=i),"content-loading":t(s),label:"name",options:t(a).itemUnits,"value-prop":"id",placeholder:e.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:l(()=>[o(D,{onClick:ee},{default:l(()=>[o(M,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),F(" "+N(e.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),X.value?(T(),x(g,{key:0,label:e.$t("items.taxes"),"content-loading":t(s)},{default:l(()=>[o(R,{modelValue:L.value,"onUpdate:modelValue":n[5]||(n[5]=i=>L.value=i),"content-loading":t(s),options:Q.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):A("",!0),o(g,{label:e.$t("items.description"),"content-loading":t(s),error:t(m).currentItem.description.$error&&t(m).currentItem.description.$errors[0].$message},{default:l(()=>[o(se,{modelValue:t(a).currentItem.description,"onUpdate:modelValue":n[6]||(n[6]=i=>t(a).currentItem.description=i),"content-loading":t(s),name:"description",row:2,rows:"2",onInput:n[7]||(n[7]=i=>t(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(g,{label:e.$t("items.image")},{default:l(()=>[o(ie,{modelValue:V.value,"onUpdate:modelValue":n[8]||(n[8]=i=>V.value=i),base64:"","content-loading":t(s),onChange:O,onRemove:W},null,8,["modelValue","content-loading"])]),_:1},8,["label"]),U("div",null,[o(Ne,{type:"Item","grid-layout":"one-column",store:t(a),"store-prop":"currentItem","is-edit":B.value,"is-loading":t(s),"custom-field-scope":G},null,8,["store","is-edit","is-loading"])]),U("div",null,[o(re,{"content-loading":t(s),type:"submit",loading:y.value},{left:l(i=>[y.value?A("",!0):(T(),x(M,{key:0,name:"SaveIcon",class:Se(i.class)},null,8,["class"]))]),default:l(()=>[F(" "+N(B.value?e.$t("items.update_item"):e.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],32)]),_:1})}}};export{Re as default};
