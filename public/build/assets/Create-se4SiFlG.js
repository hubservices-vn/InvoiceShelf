import{ae as le,at as se,au as re,F as ie,E as ue,v as me,L as ce,e as de,M as pe,f as I,k as d,j as ge,Q as _e,X as fe,r as i,o as S,m as h,w as l,a as o,b as M,l as t,p as C,t as T,K as q,J as Ie,q as ve,g as w,h as ye,I as Be,ai as $e}from"./main-rWP4cpcr.js";import{_ as be}from"./ItemUnitModal-CsZ9SA8y.js";import{_ as Ve}from"./CategoryModal-660ZMBr9.js";import{u as Se}from"./category-CoSPM0Ov.js";import{_ as he}from"./CreateCustomFields-iG0JO0OX.js";import"./dynamic-import-helper-BheWnx7M.js";const z="customFields",Pe={__name:"Create",setup(Me){le();const F=Se(),a=se(),x=re(),v=ie(),A=ue(),{t:c}=me.useI18n(),y=ce(),D=de(),G=pe(),_=I(!1),B=I(A.selectedCompanySettings.tax_per_item);let s=I(!1);a.$reset(),J();function j(){v.openModal({title:c("settings.category.add_category"),componentName:"CategoryModal",size:"sm",refreshData:k,data:{type:"item"}})}const U=I([]),$=I(!1);async function k(e=void 0){var u;$.value=!0;const n=await F.fetchCategories({search:e,type:"item"});n.data.data.length&&(U.value=((u=n.data)==null?void 0:u.data)||[]),$.value=!1}const b=d({get:()=>a.currentItem.price/100,set:e=>{a.currentItem.price=Math.round(e*100)}}),P=d({get:()=>{var e,n;return(n=(e=a==null?void 0:a.currentItem)==null?void 0:e.taxes)==null?void 0:n.map(u=>{if(u)return{...u,tax_type_id:u.id,tax_name:u.name+" ("+u.percent+"%)"}})},set:e=>{a.currentItem.taxes=e}}),f=d(()=>y.name==="items.edit"),N=d(()=>f.value?c("items.edit_item"):c("items.new_item")),Y=d(()=>x.taxTypes.map(e=>({...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}))),H=d(()=>B.value==="YES"),R=d(()=>({currentItem:{name:{required:w.withMessage(c("validation.required"),ye),minLength:w.withMessage(c("validation.name_min_length",{count:2}),Be(2))},description:{maxLength:w.withMessage(c("validation.description_maxlength"),$e(65e3))}}})),m=ge(R,a,{$scope:z});async function X(){v.openModal({title:c("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function J(){if(s.value=!0,await a.fetchItemUnits({limit:"all"}),G.hasAbilities(_e.VIEW_TAX_TYPE)&&await x.fetchTaxTypes({limit:"all"}),f.value){let e=y.params.id;await a.fetchItem(e),a.currentItem.tax_per_item===1?B.value="YES":B.value="NO"}s.value=!1}async function K(){if(m.value.$touch(),m.value.$invalid)return!1;_.value=!0;try{let n={id:y.params.id,...a.currentItem};a.currentItem&&a.currentItem.taxes&&(n.taxes=a.currentItem.taxes.map(p=>({tax_type_id:p.tax_type_id,amount:b.value*p.percent,percent:p.percent,name:p.name,collective_tax:0}))),await(f.value?a.updateItem:a.addItem)(n),_.value=!1,D.push("/admin/items"),e()}catch{_.value=!1;return}function e(){v.closeModal(),setTimeout(()=>{a.resetCurrentItem(),v.$reset(),m.value.$reset()},300)}}return fe(()=>{k()}),(e,n)=>{const u=i("BaseBreadcrumbItem"),p=i("BaseBreadcrumb"),O=i("BasePageHeader"),Q=i("BaseInput"),g=i("BaseInputGroup"),V=i("BaseIcon"),E=i("BaseSelectAction"),W=i("BaseTreeSelect"),Z=i("BaseMoney"),L=i("BaseMultiselect"),ee=i("BaseTextarea"),te=i("BaseButton"),ae=i("BaseInputGrid"),ne=i("BaseCard"),oe=i("BasePage");return S(),h(oe,null,{default:l(()=>[o(O,{title:N.value},{default:l(()=>[o(p,null,{default:l(()=>[o(u,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),o(u,{title:e.$t("items.item",2),to:"/admin/items"},null,8,["title"]),o(u,{title:N.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(be),o(Ve),M("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:ve(K,["prevent"])},[o(ne,{class:"w-full"},{default:l(()=>[o(ae,{layout:"one-column"},{default:l(()=>[o(g,{label:e.$t("items.name"),"content-loading":t(s),required:"",error:t(m).currentItem.name.$error&&t(m).currentItem.name.$errors[0].$message},{default:l(()=>[o(Q,{modelValue:t(a).currentItem.name,"onUpdate:modelValue":n[0]||(n[0]=r=>t(a).currentItem.name=r),"content-loading":t(s),invalid:t(m).currentItem.name.$error,onInput:n[1]||(n[1]=r=>t(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(g,{label:e.$t("expenses.category"),"content-loading":t(s)},{default:l(()=>[o(W,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:e.$t("expenses.categories.select_a_category"),"parent-prop":"parent_id",options:U.value,"content-loading":t(s),loading:$.value,modelValue:t(a).currentItem.category_id,"onUpdate:modelValue":n[2]||(n[2]=r=>t(a).currentItem.category_id=r)},{"after-list":l(()=>[o(E,{onClick:j},{default:l(()=>[o(V,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),C(" "+T(e.$t("settings.category.add_new_category")),1)]),_:1})]),_:1},8,["placeholder","options","content-loading","loading","modelValue"])]),_:1},8,["label","content-loading"]),o(g,{label:e.$t("items.price"),"content-loading":t(s)},{default:l(()=>[o(Z,{modelValue:b.value,"onUpdate:modelValue":n[3]||(n[3]=r=>b.value=r),"content-loading":t(s)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(g,{"content-loading":t(s),label:e.$t("items.unit")},{default:l(()=>[o(L,{modelValue:t(a).currentItem.unit_id,"onUpdate:modelValue":n[4]||(n[4]=r=>t(a).currentItem.unit_id=r),"content-loading":t(s),label:"name",options:t(a).itemUnits,"value-prop":"id",placeholder:e.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:l(()=>[o(E,{onClick:X},{default:l(()=>[o(V,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),C(" "+T(e.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),H.value?(S(),h(g,{key:0,label:e.$t("items.taxes"),"content-loading":t(s)},{default:l(()=>[o(L,{modelValue:P.value,"onUpdate:modelValue":n[5]||(n[5]=r=>P.value=r),"content-loading":t(s),options:Y.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):q("",!0),o(g,{label:e.$t("items.description"),"content-loading":t(s),error:t(m).currentItem.description.$error&&t(m).currentItem.description.$errors[0].$message},{default:l(()=>[o(ee,{modelValue:t(a).currentItem.description,"onUpdate:modelValue":n[6]||(n[6]=r=>t(a).currentItem.description=r),"content-loading":t(s),name:"description",row:2,rows:"2",onInput:n[7]||(n[7]=r=>t(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),M("div",null,[o(he,{type:"Item","grid-layout":"one-column",store:t(a),"store-prop":"currentItem","is-edit":f.value,"is-loading":t(s),"custom-field-scope":z},null,8,["store","is-edit","is-loading"])]),M("div",null,[o(te,{"content-loading":t(s),type:"submit",loading:_.value},{left:l(r=>[_.value?q("",!0):(S(),h(V,{key:0,name:"SaveIcon",class:Ie(r.class)},null,8,["class"]))]),default:l(()=>[C(" "+T(f.value?e.$t("items.update_item"):e.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],32)]),_:1})}}};export{Pe as default};
