import{v as N,F as K,as as D,f as $,X as O,r as i,o as f,c as U,a as t,b as B,l as e,w as o,p as j,t as T,N as G,av as W,E as X,ae as Q,L as Z,e as ee,k as w,g as v,h as I,ai as te,ag as ae,W as se,j as ne,z as oe,m as b,K as q,J as ie,q as le,P as re}from"./main-rWP4cpcr.js";import{_ as de,a as me,b as ce,c as ue,d as ge,e as pe,f as _e}from"./SalesTax-CJHiomPr.js";import{_ as fe}from"./CreateCustomFields-iG0JO0OX.js";import{_ as ye}from"./ExchangeRateConverter-NPDBLUVt.js";import{_ as ve}from"./CategoryModal-660ZMBr9.js";import{u as Ee}from"./category-CoSPM0Ov.js";import{_ as we}from"./TaxTypeModal-CS6FElhW.js";import"./DragIcon-Du5bhkau.js";import"./SelectNotePopup-DTaVgUJG.js";import"./NoteModal-Dt0rLxtp.js";import"./payment-Bmvphdvy.js";import"./dynamic-import-helper-BheWnx7M.js";import"./exchange-rate-C4-n2wIJ.js";const be={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},Be={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const{t:a}=N.useI18n(),k=K(),h=Ee(),r=D();function p(){k.openModal({title:a("settings.category.add_category"),componentName:"CategoryModal",size:"sm",refreshData:S,data:{type:"estimate"}})}const _=$([]),E=$(!1);async function S(c=void 0){var u;E.value=!0;const l=await h.fetchCategories({search:c,type:"estimate"});l.data.data.length&&(_.value=((u=l.data)==null?void 0:u.data)||[]),E.value=!1}return O(()=>{S()}),(c,l)=>{const u=i("BaseCustomerSelectPopup"),C=i("BaseDatePicker"),g=i("BaseInputGroup"),x=i("BaseInput"),V=i("BaseIcon"),y=i("BaseSelectAction"),L=i("BaseTreeSelect"),s=i("BaseInputGrid");return f(),U(G,null,[t(ve),B("div",be,[t(u,{modelValue:e(r).newEstimate.customer,"onUpdate:modelValue":l[0]||(l[0]=m=>e(r).newEstimate.customer=m),valid:n.v.customer_id,"content-loading":n.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),t(s,{class:"col-span-7"},{default:o(()=>[t(g,{label:c.$t("reports.estimates.estimate_date"),"content-loading":n.isLoading,required:"",error:n.v.estimate_date.$error&&n.v.estimate_date.$errors[0].$message},{default:o(()=>[t(C,{modelValue:e(r).newEstimate.estimate_date,"onUpdate:modelValue":l[1]||(l[1]=m=>e(r).newEstimate.estimate_date=m),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(g,{label:c.$t("estimates.expiry_date"),"content-loading":n.isLoading},{default:o(()=>[t(C,{modelValue:e(r).newEstimate.expiry_date,"onUpdate:modelValue":l[2]||(l[2]=m=>e(r).newEstimate.expiry_date=m),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(g,{label:c.$t("estimates.estimate_number"),"content-loading":n.isLoading,required:"",error:n.v.estimate_number.$error&&n.v.estimate_number.$errors[0].$message},{default:o(()=>[t(x,{modelValue:e(r).newEstimate.estimate_number,"onUpdate:modelValue":l[3]||(l[3]=m=>e(r).newEstimate.estimate_number=m),"content-loading":n.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(g,{label:c.$t("categories.label"),"content-loading":n.isLoading},{default:o(()=>[t(L,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:c.$t("categories.select_a_category"),"parent-prop":"parent_id",options:_.value,"content-loading":n.isLoading,loading:E.value,modelValue:e(r).newEstimate.category_id,"onUpdate:modelValue":l[4]||(l[4]=m=>e(r).newEstimate.category_id=m)},{"after-list":o(()=>[t(y,{onClick:p},{default:o(()=>[t(V,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),j(" "+T(c.$t("settings.category.add_new_category")),1)]),_:1})]),_:1},8,["placeholder","options","content-loading","loading","modelValue"])]),_:1},8,["label","content-loading"]),t(ye,{store:e(r),"store-prop":"newEstimate",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":e(r).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])],64)}}},$e={class:"flex"},he={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},Se={class:"relative w-full lg:w-1/2"},P="newEstimate",Ue={__name:"EstimateCreate",setup(n){const a=D(),k=W(),h=X(),r=Q(),{t:p}=N.useI18n();let _=$(!1);const E=$(!1),S=$(["customer","company","customerCustom","estimate","estimateCustom"]);let c=Z(),l=ee(),u=w(()=>a.isFetchingInitialSettings),C=w(()=>g.value?p("estimates.edit_estimate"):p("estimates.new_estimate")),g=w(()=>c.name==="estimates.edit");const x=w(()=>h.selectedCompanySettings.sales_tax_us_enabled==="YES"&&k.salesTaxUSEnabled),V={estimate_date:{required:v.withMessage(p("validation.required"),I)},estimate_number:{required:v.withMessage(p("validation.required"),I)},reference_number:{maxLength:v.withMessage(p("validation.price_maxlength"),te(255))},customer_id:{required:v.withMessage(p("validation.required"),I)},exchange_rate:{required:ae(function(){return v.withMessage(p("validation.required"),I),a.showExchangeRate}),decimal:v.withMessage(p("validation.valid_exchange_rate"),se)}},y=ne(V,w(()=>a.newEstimate),{$scope:P});oe(()=>a.newEstimate.customer,s=>{s&&s.currency?a.newEstimate.selectedCurrency=s.currency:a.newEstimate.selectedCurrency=h.selectedCompanyCurrency}),a.resetCurrentEstimate(),r.resetCustomFields(),y.value.$reset,a.fetchEstimateInitialSettings(g.value);async function L(){if(y.value.$touch(),y.value.$invalid)return!1;_.value=!0;let s=re.cloneDeep({...a.newEstimate,sub_total:a.getSubTotal,total:a.getTotal,tax:a.getTotalTax});s.discount_per_item==="YES"?s.items.forEach((d,M)=>{d.discount_type==="fixed"&&(s.items[M].discount=Math.round(d.discount*100))}):s.discount_type==="fixed"&&(s.discount=Math.round(s.discount*100)),!a.newEstimate.tax_per_item==="YES"&&s.taxes.length&&(s.tax_type_ids=s.taxes.map(d=>d.tax_type_id));const m=g.value?a.updateEstimate:a.addEstimate;try{let d=await m(s);d.data.data&&l.push(`/admin/estimates/${d.data.data.id}/view`)}catch(d){console.error(d)}_.value=!1}return(s,m)=>{const d=i("BaseBreadcrumbItem"),M=i("BaseBreadcrumb"),F=i("BaseButton"),z=i("router-link"),A=i("BaseIcon"),R=i("BasePageHeader"),Y=i("BaseScrollPane"),H=i("BasePage");return f(),U(G,null,[t(de),t(me),t(we),x.value&&(!e(u)||e(c).query.customer)?(f(),b(ce,{key:0,store:e(a),"store-prop":"newEstimate","is-edit":e(g),customer:e(a).newEstimate.customer},null,8,["store","is-edit","customer"])):q("",!0),t(H,{class:"relative estimate-create-page"},{default:o(()=>[B("form",{onSubmit:le(L,["prevent"])},[t(R,{title:e(C)},{actions:o(()=>[s.$route.name==="estimates.edit"?(f(),b(z,{key:0,to:`/estimates/pdf/${e(a).newEstimate.unique_hash}`,target:"_blank"},{default:o(()=>[t(F,{class:"mr-3",variant:"primary-outline",type:"button"},{default:o(()=>[B("span",$e,T(s.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):q("",!0),t(F,{loading:e(_),disabled:e(_),"content-loading":e(u),variant:"primary",type:"submit"},{left:o(J=>[e(_)?q("",!0):(f(),b(A,{key:0,class:ie(J.class),name:"SaveIcon"},null,8,["class"]))]),default:o(()=>[j(" "+T(s.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:o(()=>[t(M,null,{default:o(()=>[t(d,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(d,{title:s.$t("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),s.$route.name==="estimates.edit"?(f(),b(d,{key:0,title:s.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(f(),b(d,{key:1,title:s.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),t(Be,{v:e(y),"is-loading":e(u),"is-edit":e(g)},null,8,["v","is-loading","is-edit"]),t(Y,null,{default:o(()=>[t(ue,{currency:e(a).newEstimate.selectedCurrency,"is-loading":e(u),"item-validation-scope":P,store:e(a),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),B("div",he,[B("div",Se,[t(ge,{store:e(a),"store-prop":"newEstimate",fields:S.value,type:"Estimate"},null,8,["store","fields"]),t(fe,{type:"Estimate","is-edit":e(g),"is-loading":e(u),store:e(a),"store-prop":"newEstimate","custom-field-scope":P,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(pe,{store:e(a),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":E.value},null,8,["store","is-mark-as-default"])]),t(_e,{currency:e(a).newEstimate.selectedCurrency,"is-loading":e(u),store:e(a),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Ue as default};
