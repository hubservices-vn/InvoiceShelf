import{a8 as ce,E as pe,ae as me,F as ge,L as xe,e as _e,v as fe,G as ye,f as b,k as h,j as ve,aD as Ee,X as $e,r as i,o as $,c as be,a as r,w as o,b as k,l as e,m as C,J as D,p as V,t as w,K as S,q as he,N as Ce,g as p,h as B,aF as Be,ai as j,ag as Ve,W as we}from"./main-BIpkCKxL.js";import{u as Se}from"./expense-Dh-ttkXY.js";import{u as Me}from"./category-Bh9-3vHq.js";import{_ as Ie}from"./CreateCustomFields-CCOI504W.js";import{_ as qe}from"./CategoryModal-B2q-waij.js";import{_ as Fe}from"./ExchangeRateConverter-9I5CDeSu.js";import"./dynamic-import-helper-BheWnx7M.js";import"./exchange-rate-DLg3dqty.js";const ke={class:"hidden md:block"},De={class:"block md:hidden"},L="newExpense",ze={__name:"Create",setup(Ue){const _=ce(),U=pe(),t=Se(),f=Me(),A=me(),z=ge(),v=xe(),H=_e(),{t:d}=fe.useI18n(),R=ye();let m=b(!1),l=b(!1);const M=b(!1),O=h(()=>({currentExpense:{expense_category_id:{required:p.withMessage(d("validation.required"),B)},expense_date:{required:p.withMessage(d("validation.required"),B)},amount:{required:p.withMessage(d("validation.required"),B),minValue:p.withMessage(d("validation.price_minvalue"),Be(.1)),maxLength:p.withMessage(d("validation.price_maxlength"),j(20))},notes:{maxLength:p.withMessage(d("validation.description_maxlength"),j(65e3))},currency_id:{required:p.withMessage(d("validation.required"),B)},exchange_rate:{required:Ve(function(){return p.withMessage(d("validation.required"),B),t.showExchangeRate}),decimal:p.withMessage(d("validation.valid_exchange_rate"),we)}}})),u=ve(O,t,{$scope:L}),P=h({get:()=>t.currentExpense.amount/100,set:n=>{t.currentExpense.amount=Math.round(n*100)}}),c=h(()=>v.name==="expenses.edit"),N=h(()=>c.value?d("expenses.edit_expense"):d("expenses.new_expense")),J=h(()=>c.value?`/reports/expenses/${v.params.id}/download-receipt`:"");t.resetCurrentExpenseData(),A.resetCustomFields(),Z();function K(n,a){t.currentExpense.attachment_receipt=a}function W(){t.currentExpense.attachment_receipt=null,M.value=!0}function X(){z.openModal({title:d("settings.category.add_category"),componentName:"CategoryModal",size:"sm",refreshData:T,data:{type:"expense"}})}function Q(n){t.currentExpense.selectedCurrency=R.currencies.find(a=>a.id===n)}const G=b([]),I=b(!1);async function T(n=void 0){var y;I.value=!0;let a=await f.fetchCategories({search:n,type:"expense"});if(a.data.data.length>0&&f.editCategory&&!a.data.data.find(g=>g.id==f.editCategory.id)){let g=Object.assign({},f.editCategory);a.data.data.unshift(g)}G.value=((y=a.data)==null?void 0:y.data)||[],I.value=!1}async function Y(n){let a=await _.fetchCustomers({search:n});if(a.data.data.length>0&&_.editCustomer&&!a.data.data.find(E=>E.id==_.editCustomer.id)){let E=Object.assign({},_.editCustomer);a.data.data.unshift(E)}return a.data.data}async function Z(){if(c.value||(t.currentExpense.currency_id=U.selectedCompanyCurrency.id,t.currentExpense.selectedCurrency=U.selectedCompanyCurrency),l.value=!0,await t.fetchPaymentModes({limit:"all"}),c.value){const n=await t.fetchExpense(v.params.id);t.currentExpense.currency_id=t.currentExpense.selectedCurrency.id,n.data&&(!f.editCategory&&n.data.data.expense_category&&(f.editCategory=n.data.data.expense_category),!_.editCustomer&&n.data.data.customer&&(_.editCustomer=n.data.data.customer))}else v.query.customer&&(t.currentExpense.customer_id=v.query.customer);l.value=!1}async function ee(){if(u.value.$touch(),u.value.$invalid)return;m.value=!0;let n=t.currentExpense;try{c.value?await t.updateExpense({id:v.params.id,data:n,isAttachmentReceiptRemoved:M.value}):await t.addExpense(n),m.value=!1,t.currentExpense.attachment_receipt=null,M.value=!1,H.push("/admin/expenses")}catch(a){console.error(a),m.value=!1;return}}return Ee(()=>{t.resetCurrentExpenseData(),_.editCustomer=null,f.editCategory=null}),$e(()=>{T()}),(n,a)=>{const y=i("BaseBreadcrumbItem"),E=i("BaseBreadcrumb"),g=i("BaseIcon"),q=i("BaseButton"),te=i("BasePageHeader"),ne=i("BaseSelectAction"),ae=i("BaseTreeSelect"),x=i("BaseInputGroup"),re=i("BaseDatePicker"),se=i("BaseMoney"),F=i("BaseMultiselect"),oe=i("BaseTextarea"),le=i("BaseFileUploader"),ue=i("BaseInputGrid"),ie=i("BaseCard"),de=i("BasePage");return $(),be(Ce,null,[r(qe),r(de,{class:"relative"},{default:o(()=>[k("form",{action:"",onSubmit:he(ee,["prevent"])},[r(te,{title:N.value,class:"mb-5"},{actions:o(()=>[c.value&&e(t).currentExpense.attachment_receipt_url?($(),C(q,{key:0,href:J.value,tag:"a",variant:"primary-outline",type:"button",class:"mr-2"},{left:o(s=>[r(g,{name:"DownloadIcon",class:D(s.class)},null,8,["class"])]),default:o(()=>[V(" "+w(n.$t("expenses.download_receipt")),1)]),_:1},8,["href"])):S("",!0),k("div",ke,[r(q,{loading:e(m),"content-loading":e(l),disabled:e(m),variant:"primary",type:"submit"},{left:o(s=>[e(m)?S("",!0):($(),C(g,{key:0,name:"SaveIcon",class:D(s.class)},null,8,["class"]))]),default:o(()=>[V(" "+w(c.value?n.$t("expenses.update_expense"):n.$t("expenses.save_expense")),1)]),_:1},8,["loading","content-loading","disabled"])])]),default:o(()=>[r(E,null,{default:o(()=>[r(y,{title:n.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(y,{title:n.$t("expenses.expense",2),to:"/admin/expenses"},null,8,["title"]),r(y,{title:N.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(ie,null,{default:o(()=>[r(ue,null,{default:o(()=>[r(x,{label:n.$t("expenses.category"),error:e(u).currentExpense.expense_category_id.$error&&e(u).currentExpense.expense_category_id.$errors[0].$message,"content-loading":e(l),required:""},{default:o(()=>[r(ae,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:n.$t("expenses.categories.select_a_category"),"parent-prop":"parent_id",options:G.value,"content-loading":e(l),loading:I.value,modelValue:e(t).currentExpense.expense_category_id,"onUpdate:modelValue":a[0]||(a[0]=s=>e(t).currentExpense.expense_category_id=s)},{"after-list":o(()=>[r(ne,{onClick:X},{default:o(()=>[r(g,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),V(" "+w(n.$t("settings.category.add_new_category")),1)]),_:1})]),_:1},8,["placeholder","options","content-loading","loading","modelValue"])]),_:1},8,["label","error","content-loading"]),r(x,{label:n.$t("expenses.expense_date"),error:e(u).currentExpense.expense_date.$error&&e(u).currentExpense.expense_date.$errors[0].$message,"content-loading":e(l),required:""},{default:o(()=>[r(re,{modelValue:e(t).currentExpense.expense_date,"onUpdate:modelValue":a[1]||(a[1]=s=>e(t).currentExpense.expense_date=s),"content-loading":e(l),"calendar-button":!0,invalid:e(u).currentExpense.expense_date.$error,onInput:a[2]||(a[2]=s=>e(u).currentExpense.expense_date.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","error","content-loading"]),r(x,{label:n.$t("expenses.amount"),error:e(u).currentExpense.amount.$error&&e(u).currentExpense.amount.$errors[0].$message,"content-loading":e(l),required:""},{default:o(()=>[($(),C(se,{key:e(t).currentExpense.selectedCurrency,modelValue:P.value,"onUpdate:modelValue":a[3]||(a[3]=s=>P.value=s),class:"focus:border focus:border-solid focus:border-primary-500",invalid:e(u).currentExpense.amount.$error,currency:e(t).currentExpense.selectedCurrency,onInput:a[4]||(a[4]=s=>e(u).currentExpense.amount.$touch())},null,8,["modelValue","invalid","currency"]))]),_:1},8,["label","error","content-loading"]),r(x,{label:n.$t("expenses.currency"),"content-loading":e(l),error:e(u).currentExpense.currency_id.$error&&e(u).currentExpense.currency_id.$errors[0].$message,required:""},{default:o(()=>[r(F,{modelValue:e(t).currentExpense.currency_id,"onUpdate:modelValue":[a[5]||(a[5]=s=>e(t).currentExpense.currency_id=s),Q],"value-prop":"id",label:"name","track-by":"name","content-loading":e(l),options:e(R).currencies,searchable:"","can-deselect":!1,placeholder:n.$t("customers.select_currency"),invalid:e(u).currentExpense.currency_id.$error,class:"w-full"},null,8,["modelValue","content-loading","options","placeholder","invalid"])]),_:1},8,["label","content-loading","error"]),r(Fe,{store:e(t),"store-prop":"currentExpense",v:e(u).currentExpense,"is-loading":e(l),"is-edit":c.value,"customer-currency":e(t).currentExpense.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"]),r(x,{"content-loading":e(l),label:n.$t("expenses.customer")},{default:o(()=>[e(l)?S("",!0):($(),C(F,{key:0,modelValue:e(t).currentExpense.customer_id,"onUpdate:modelValue":a[6]||(a[6]=s=>e(t).currentExpense.customer_id=s),"content-loading":e(l),"value-prop":"id",label:"name","track-by":"id",options:Y,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",placeholder:n.$t("customers.select_a_customer")},null,8,["modelValue","content-loading","placeholder"]))]),_:1},8,["content-loading","label"]),r(x,{"content-loading":e(l),label:n.$t("payments.payment_mode")},{default:o(()=>[r(F,{modelValue:e(t).currentExpense.payment_method_id,"onUpdate:modelValue":a[7]||(a[7]=s=>e(t).currentExpense.payment_method_id=s),"content-loading":e(l),label:"name","value-prop":"id","track-by":"name",options:e(t).paymentModes,placeholder:n.$t("payments.select_payment_mode"),searchable:""},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r(x,{"content-loading":e(l),label:n.$t("expenses.note"),error:e(u).currentExpense.notes.$error&&e(u).currentExpense.notes.$errors[0].$message},{default:o(()=>[r(oe,{modelValue:e(t).currentExpense.notes,"onUpdate:modelValue":a[8]||(a[8]=s=>e(t).currentExpense.notes=s),"content-loading":e(l),row:4,rows:"4",onInput:a[9]||(a[9]=s=>e(u).currentExpense.notes.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label","error"]),r(x,{label:n.$t("expenses.receipt")},{default:o(()=>[r(le,{modelValue:e(t).currentExpense.receiptFiles,"onUpdate:modelValue":a[10]||(a[10]=s=>e(t).currentExpense.receiptFiles=s),accept:"image/*,.doc,.docx,.pdf,.csv,.xlsx,.xls",onChange:K,onRemove:W},null,8,["modelValue"])]),_:1},8,["label"]),r(Ie,{"is-edit":c.value,class:"col-span-2","is-loading":e(l),type:"Expense",store:e(t),"store-prop":"currentExpense","custom-field-scope":L},null,8,["is-edit","is-loading","store"]),k("div",De,[r(q,{loading:e(m),tabindex:6,variant:"primary",type:"submit",class:"flex justify-center w-full"},{left:o(s=>[e(m)?S("",!0):($(),C(g,{key:0,name:"SaveIcon",class:D(s.class)},null,8,["class"]))]),default:o(()=>[V(" "+w(c.value?n.$t("expenses.update_expense"):n.$t("expenses.save_expense")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})],32)]),_:1})],64)}}};export{ze as default};
