import{a3 as z,s as v,a0 as $,u as T,F,v as A,f as G,k as N,g as b,h as q,I as J,ah as K,j as O,aa as H,r as m,o as x,m as M,w as u,b as C,p as V,t as S,l as t,a as s,q as X,J as L,K as Y}from"./main-CO79g86p.js";const Q=(P=!1)=>{const a=P?window.pinia.defineStore:z,{global:r}=window.i18n;return a({id:"calendar",state:()=>({calendars:[],currentCalendar:{id:null,title:"",estimate_id:null,customer_id:null,invoice_id:null,start:"",end:"",description:""},editCalendar:null,calendarTypes:{invoice:"Invoice",estimate:"Estimate"}}),getters:{isEdit:n=>!!n.currentCalendar.id,calendarItems:n=>Object.keys(n.calendarTypes).reduce((l,o)=>[...l,{id:o,label:n.calendarTypes[o]}],[])},actions:{fetchCalendars(n){return new Promise((l,o)=>{v.get("/api/v1/calendars",{params:n}).then(e=>{this.calendars=e.data.data,l(e)}).catch(e=>{$(e),o(e)})})},fetchCalendar(n){return new Promise((l,o)=>{v.get(`/api/v1/calendars/${n}`).then(e=>{l(e)}).catch(e=>{$(e),o(e)})})},addCalendar(n){return new Promise((l,o)=>{v.post("/api/v1/calendars",n).then(e=>{this.calendars.push(e.data.data),T().showNotification({type:"success",message:r.t("settings.category.created_message")}),l(e)}).catch(e=>{$(e),o(e)})})},updateCalendar(n){return new Promise((l,o)=>{v.put(`/api/v1/calendars/${n.id}`,n).then(e=>{if(e.data){let w=this.calendars.findIndex(k=>k.id===e.data.data.id);this.calendars[w]=n.calendars,T().showNotification({type:"success",message:r.t("settings.category.updated_message")})}l(e)}).catch(e=>{$(e),o(e)})})},deleteCalendar(n){return new Promise(l=>{v.delete(`/api/v1/calendars/${n}`).then(o=>{T().showNotification({type:"success",message:r.t("settings.category.deleted_message")}),l(o)}).catch(o=>{$(o),console.error(o)})})}}})()},R={class:"flex justify-between w-full"},W={class:"p-8 sm:p-6"},Z={class:"z-0 flex justify-between p-4 border-t border-gray-200 border-solid border-modal-bg"},ee={class:"flex items-center"},te={__name:"CalendarModal",setup(P){const a=Q(),r=F(),{t:n}=A.useI18n();let l=G(!1);G([]);const o=N(()=>({currentCalendar:{title:{required:b.withMessage(n("validation.required"),q),minLength:b.withMessage(n("validation.name_min_length",{count:3}),J(3))},description:{maxLength:b.withMessage(n("validation.description_maxlength",{count:255}),K(255))},start:{required:b.withMessage(n("validation.required"),q)},end:{required:b.withMessage(n("validation.required"),q)}}})),e=O(o,N(()=>a)),w=N(()=>{var d,i,f,B,p,I,g,_,h;return r&&r.data&&(a.currentCalendar.id=r==null?void 0:r.id,a.currentCalendar[`${(d=r.data)==null?void 0:d.type}_id`]=r.data.id,a.currentCalendar.customer_id=(i=r.data)==null?void 0:i.customerId,a.currentCalendar.customer_name=(f=r.data)==null?void 0:f.customerName,a.currentCalendar.user_id=(B=r.data)==null?void 0:B.userId,a.currentCalendar.user_name=(p=r.data)==null?void 0:p.userName,a.currentCalendar.title=(I=r.data)==null?void 0:I.title,a.currentCalendar.description=(g=r.data)==null?void 0:g.description,a.currentCalendar.start=((_=r.data)==null?void 0:_.start)||H(new Date).format("YYYY-MM-DD HH:mm:ss"),a.currentCalendar.end=((h=r.data)==null?void 0:h.end)||H(new Date).format("YYYY-MM-DD HH:mm:ss")),r.active&&r.componentName==="CalendarModal"});async function E(){if(e.value.currentCalendar.$touch(),e.value.currentCalendar.$invalid)return!0;const d=a.isEdit?a.updateCalendar:a.addCalendar;l.value=!0,await d(a.currentCalendar),l.value=!1,r.refreshData&&r.refreshData(),y()}function k(d){a.deleteCalendar(d).then(()=>{r.refreshData&&r.refreshData(),r.closeModal()})}function y(){r.closeModal(),setTimeout(()=>{a.$reset(),e.value.$reset()},300)}return(d,i)=>{const f=m("BaseIcon"),B=m("BaseInput"),p=m("BaseInputGroup"),I=m("BaseTextarea"),g=m("BaseInputGrid"),_=m("BaseDatePicker"),h=m("BaseText"),j=m("router-link"),D=m("BaseButton"),U=m("BaseModal");return x(),M(U,{show:w.value,onClose:y},{header:u(()=>[C("div",R,[V(S(t(r).title)+" ",1),s(f,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:y})])]),default:u(()=>[C("form",{action:"",onSubmit:X(E,["prevent"])},[C("div",W,[s(g,{layout:"one-column"},{default:u(()=>[s(p,{label:d.$t("calendars.title"),error:t(e).currentCalendar.title.$error&&t(e).currentCalendar.title.$errors[0].$message,required:""},{default:u(()=>[s(B,{modelValue:t(a).currentCalendar.title,"onUpdate:modelValue":i[0]||(i[0]=c=>t(a).currentCalendar.title=c),invalid:t(e).currentCalendar.title.$error,type:"text",onInput:i[1]||(i[1]=c=>t(e).currentCalendar.title.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(p,{label:d.$t("categories.description"),error:t(e).currentCalendar.description.$error&&t(e).currentCalendar.description.$errors[0].$message},{default:u(()=>[s(I,{modelValue:t(a).currentCalendar.description,"onUpdate:modelValue":i[2]||(i[2]=c=>t(a).currentCalendar.description=c),rows:"4",cols:"50",onInput:i[3]||(i[3]=c=>t(e).currentCalendar.description.$touch())},null,8,["modelValue"])]),_:1},8,["label","error"])]),_:1}),s(g,{layout:"two-column",class:"mt-5"},{default:u(()=>[s(p,{label:d.$t("calendars.start_time"),error:t(e).currentCalendar.start.$error&&t(e).currentCalendar.start.$errors[0].$message},{default:u(()=>[s(_,{time24hr:!0,enableTime:!0,modelValue:t(a).currentCalendar.start,"onUpdate:modelValue":i[4]||(i[4]=c=>t(a).currentCalendar.start=c),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label","error"]),s(p,{label:d.$t("calendars.end_time"),error:t(e).currentCalendar.start.$error&&t(e).currentCalendar.start.$errors[0].$message},{default:u(()=>[s(_,{time24hr:!0,enableTime:!0,modelValue:t(a).currentCalendar.end,"onUpdate:modelValue":i[5]||(i[5]=c=>t(a).currentCalendar.end=c),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label","error"]),s(p,{label:d.$t("calendars.user")},{default:u(()=>[s(j,{to:{path:"#"}},{default:u(()=>[s(h,{text:t(a).currentCalendar.user_name,length:30,tag:"span",class:"font-medium text-primary-500 flex flex-col"},null,8,["text"])]),_:1})]),_:1},8,["label"]),s(p,{label:d.$t("calendars.customer")},{default:u(()=>[s(j,{to:{path:`customers/${t(a).currentCalendar.customer_id}/view`}},{default:u(()=>[s(h,{text:t(a).currentCalendar.customer_name,length:30,tag:"span",class:"font-medium text-primary-500 flex flex-col"},null,8,["text"])]),_:1},8,["to"])]),_:1},8,["label"])]),_:1})]),C("div",Z,[C("span",null,[t(a).isEdit?(x(),M(D,{key:0,variant:"danger",type:"button",class:"mr-3 text-sm",onClick:i[6]||(i[6]=()=>k(t(a).currentCalendar.id))},{left:u(c=>[t(l)?Y("",!0):(x(),M(f,{key:0,name:"TrashIcon",class:L(c.class)},null,8,["class"]))]),default:u(()=>[V(" "+S(d.$t("general.delete")),1)]),_:1})):Y("",!0)]),C("span",ee,[s(D,{type:"button",variant:"primary-outline",class:"mr-3 text-sm",onClick:y},{default:u(()=>[V(S(d.$t("general.cancel")),1)]),_:1}),s(D,{loading:t(l),disabled:t(l),variant:"primary",type:"submit"},{left:u(c=>[t(l)?Y("",!0):(x(),M(f,{key:0,name:"SaveIcon",class:L(c.class)},null,8,["class"]))]),default:u(()=>[V(" "+S(t(a).isEdit?d.$t("general.update"):d.$t("general.save")),1)]),_:1},8,["loading","disabled"])])])],32)]),_:1},8,["show"])}}};export{te as _,Q as u};
