import{v as H,F as J,L as K,aR as W,G as te,f as M,H as ie,k as q,z as X,X as oe,ap as ae,r as d,o as I,c as Y,b as m,a as t,l as e,t as k,w as u,m as p,K as h,p as Q,N as Z,E as re,ae as le,av as se,a8 as ce,u as ue,e as de,g as y,h as R,ag as G,W as ge,j as ve,J as me,q as fe}from"./main-BUqFeZBO.js";import{_ as ye,a as Ie,b as _e,c as be,d as we,e as pe,f as $e}from"./SalesTax-CRsu-XD5.js";import{_ as Re}from"./ExchangeRateConverter-BX-Ip4UO.js";import{_ as qe}from"./CategoryModal-CliltnPR.js";import{u as Be}from"./category-CkcD3_FT.js";import{_ as Se}from"./CreateCustomFields-CJNrm9Wf.js";import{_ as he}from"./TaxTypeModal-cW3I0vq5.js";import"./DragIcon-0ktF8GNF.js";import"./SelectNotePopup-DqpbOT3v.js";import"./NoteModal-Du7siQOr.js";import"./payment-Diwgd2sj.js";import"./exchange-rate-CZq-_MBa.js";import"./dynamic-import-helper-BheWnx7M.js";const Ce={class:"col-span-5 pr-0"},Ve={class:"flex mt-7"},Le={class:"relative w-20 mt-8"},Fe={class:"ml-2"},Me={class:"p-0 mb-1 leading-snug text-left text-black"},ke={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},Te={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},Ne={__name:"RecurringInvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const{t:a}=H.useI18n(),T=Be(),U=J(),E=n,D=K(),i=W(),N=te(),c=M(!1),f=ie([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]);function x(){U.openModal({title:a("settings.category.add_category"),componentName:"CategoryModal",size:"sm",refreshData:b,data:{type:"recurringInvoice"}})}const C=M([]),B=M(!1);async function b(r=void 0){var w;B.value=!0;const o=await T.fetchCategories({search:r,type:"recurringInvoice"});o.data.data.length&&(C.value=((w=o.data)==null?void 0:w.data)||[]),B.value=!1}const V=q(()=>i.newRecurringInvoice.selectedFrequency&&i.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),$=q(()=>E.isEdit?N.config.recurring_invoice_status.update_status:N.config.recurring_invoice_status.create_status);X(()=>i.newRecurringInvoice.selectedFrequency,r=>{i.isFetchingInitialSettings||(r&&r.value!=="CUSTOM"?i.newRecurringInvoice.frequency=r.value:i.newRecurringInvoice.frequency=null)}),oe(()=>{b(),D.params.id||_()});function S(r){return i.newRecurringInvoice.limit_by===r}const P=ae(()=>{_()},500);async function _(){const r=i.newRecurringInvoice.frequency;if(!r)return;c.value=!0;let o={starts_at:i.newRecurringInvoice.starts_at,frequency:r};try{await i.fetchRecurringInvoiceFrequencyDate(o)}catch(w){console.error(w),c.value=!1}c.value=!1}return(r,o)=>{const w=d("BaseCustomerSelectPopup"),s=d("BaseSwitch"),v=d("BaseDatePicker"),g=d("BaseInputGroup"),L=d("BaseMultiselect"),F=d("BaseInput"),O=d("BaseIcon"),A=d("BaseSelectAction"),j=d("BaseTreeSelect");return I(),Y(Z,null,[m("div",Ce,[t(qe),t(w,{modelValue:e(i).newRecurringInvoice.customer,"onUpdate:modelValue":o[0]||(o[0]=l=>e(i).newRecurringInvoice.customer=l),valid:n.v.customer_id,"content-loading":n.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),m("div",Ve,[m("div",Le,[t(s,{modelValue:e(i).newRecurringInvoice.send_automatically,"onUpdate:modelValue":o[1]||(o[1]=l=>e(i).newRecurringInvoice.send_automatically=l),class:"absolute -top-4"},null,8,["modelValue"])]),m("div",Fe,[m("p",Me,k(r.$t("recurring_invoices.send_automatically")),1),m("p",ke,k(r.$t("recurring_invoices.send_automatically_desc")),1)])])]),m("div",Te,[t(g,{label:r.$t("recurring_invoices.starts_at"),"content-loading":n.isLoading,required:"",error:n.v.starts_at.$error&&n.v.starts_at.$errors[0].$message},{default:u(()=>[t(v,{modelValue:e(i).newRecurringInvoice.starts_at,"onUpdate:modelValue":o[2]||(o[2]=l=>e(i).newRecurringInvoice.starts_at=l),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:n.v.starts_at.$error,onChange:o[3]||(o[3]=l=>_())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),t(g,{label:r.$t("recurring_invoices.next_invoice_date"),"content-loading":n.isLoading,required:""},{default:u(()=>[t(v,{modelValue:e(i).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":o[4]||(o[4]=l=>e(i).newRecurringInvoice.next_invoice_at=l),"content-loading":n.isLoading,"calendar-button":!0,disabled:!0,loading:c.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),t(g,{label:r.$t("recurring_invoices.limit_by"),"content-loading":n.isLoading,class:"lg:mt-0",required:"",error:n.v.limit_by.$error&&n.v.limit_by.$errors[0].$message},{default:u(()=>[t(L,{modelValue:e(i).newRecurringInvoice.limit_by,"onUpdate:modelValue":o[5]||(o[5]=l=>e(i).newRecurringInvoice.limit_by=l),"content-loading":n.isLoading,options:f,label:"label",invalid:n.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),S("DATE")?(I(),p(g,{key:0,label:r.$t("recurring_invoices.limit_date"),"content-loading":n.isLoading,required:S("DATE"),error:n.v.limit_date.$error&&n.v.limit_date.$errors[0].$message},{default:u(()=>[t(v,{modelValue:e(i).newRecurringInvoice.limit_date,"onUpdate:modelValue":o[6]||(o[6]=l=>e(i).newRecurringInvoice.limit_date=l),"content-loading":n.isLoading,invalid:n.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):h("",!0),S("COUNT")?(I(),p(g,{key:1,label:r.$t("recurring_invoices.count"),"content-loading":n.isLoading,required:S("COUNT"),error:n.v.limit_count.$error&&n.v.limit_count.$errors[0].$message},{default:u(()=>[t(F,{modelValue:e(i).newRecurringInvoice.limit_count,"onUpdate:modelValue":o[7]||(o[7]=l=>e(i).newRecurringInvoice.limit_count=l),"content-loading":n.isLoading,invalid:n.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):h("",!0),t(g,{label:r.$t("recurring_invoices.status"),required:"","content-loading":n.isLoading,error:n.v.status.$error&&n.v.status.$errors[0].$message},{default:u(()=>[t(L,{modelValue:e(i).newRecurringInvoice.status,"onUpdate:modelValue":o[8]||(o[8]=l=>e(i).newRecurringInvoice.status=l),options:$.value,"content-loading":n.isLoading,invalid:n.v.status.$error,placeholder:r.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),t(g,{label:r.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":n.isLoading,error:n.v.selectedFrequency.$error&&n.v.selectedFrequency.$errors[0].$message},{default:u(()=>[t(L,{modelValue:e(i).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":o[9]||(o[9]=l=>e(i).newRecurringInvoice.selectedFrequency=l),"content-loading":n.isLoading,options:e(i).frequencies,label:"label",invalid:n.v.selectedFrequency.$error,object:"",onChange:_},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),V.value?(I(),p(g,{key:2,label:r.$t("recurring_invoices.frequency.title"),"content-loading":n.isLoading,required:"",error:n.v.frequency.$error&&n.v.frequency.$errors[0].$message},{default:u(()=>[t(F,{modelValue:e(i).newRecurringInvoice.frequency,"onUpdate:modelValue":[o[10]||(o[10]=l=>e(i).newRecurringInvoice.frequency=l),e(P)],"content-loading":n.isLoading,disabled:!V.value,invalid:n.v.frequency.$error,loading:c.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):h("",!0),t(g,{label:r.$t("categories.label"),"content-loading":n.isLoading},{default:u(()=>[t(j,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:r.$t("categories.select_a_category"),"parent-prop":"parent_id",options:C.value,"content-loading":n.isLoading,loading:B.value,modelValue:e(i).newRecurringInvoice.category_id,"onUpdate:modelValue":o[11]||(o[11]=l=>e(i).newRecurringInvoice.category_id=l)},{"after-list":u(()=>[t(A,{onClick:x},{default:u(()=>[t(O,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),Q(" "+k(r.$t("settings.category.add_new_category")),1)]),_:1})]),_:1},8,["placeholder","options","content-loading","loading","modelValue"])]),_:1},8,["label","content-loading"]),t(Re,{store:e(i),"store-prop":"newRecurringInvoice",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":e(i).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},Ue={class:"flex"},Ee={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},De={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},xe={class:"w-full relative lg:w-1/2"},z="newRecurringInvoice",Ze={__name:"RecurringInvoiceCreate",setup(n){const a=W(),T=re(),U=le(),E=se(),D=J(),i=ce(),N=ue(),{t:c}=H.useI18n();let f=M(!1);const x=M(["customer","company","customerCustom","invoice","invoiceCustom"]);let C=K(),B=de(),b=q(()=>a.isFetchingInvoice||a.isFetchingInitialSettings),V=q(()=>$.value?c("recurring_invoices.edit_invoice"):c("recurring_invoices.new_invoice")),$=q(()=>C.name==="recurring-invoices.edit");const S=q(()=>T.selectedCompanySettings.sales_tax_us_enabled==="YES"&&E.salesTaxUSEnabled),P={starts_at:{required:y.withMessage(c("validation.required"),R)},status:{required:y.withMessage(c("validation.required"),R)},frequency:{required:y.withMessage(c("validation.required"),R)},limit_by:{required:y.withMessage(c("validation.required"),R)},limit_date:{required:y.withMessage(c("validation.required"),G(function(){return a.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:y.withMessage(c("validation.required"),G(function(){return a.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:y.withMessage(c("validation.required"),R)},customer_id:{required:y.withMessage(c("validation.required"),R)},exchange_rate:{required:G(function(){return y.withMessage(c("validation.required"),R),a.showExchangeRate}),decimal:y.withMessage(c("validation.valid_exchange_rate"),ge)}},_=ve(P,q(()=>a.newRecurringInvoice),{$scope:z});a.resetCurrentRecurringInvoice(),a.fetchRecurringInvoiceInitialSettings($.value),U.resetCustomFields(),_.value.$reset,X(()=>a.newRecurringInvoice.customer,s=>{s&&s.currency?a.newRecurringInvoice.currency=s.currency:a.newRecurringInvoice.currency=T.selectedCompanyCurrency});async function r(){if(_.value.$touch(),_.value.$invalid)return!1;f.value=!0;let s={...a.newRecurringInvoice,sub_total:a.getSubTotal,total:a.getTotal,tax:a.getTotalTax};if(s.customer&&!s.customer.email&&s.send_automatically){N.showNotification({type:"error",message:c("recurring_invoices.add_customer_email")}),o(),f.value=!1;return}C.params.id?a.updateRecurringInvoice(s).then(v=>{v.data.data&&B.push(`/admin/recurring-invoices/${v.data.data.id}/view`),f.value=!1}).catch(v=>{f.value=!1}):w(s)}async function o(){let s=a.newRecurringInvoice.customer.id;await i.fetchCustomer(s),D.openModal({title:c("customers.edit_customer"),componentName:"CustomerModal"})}function w(s){a.addRecurringInvoice(s).then(v=>{v.data.data&&B.push(`/admin/recurring-invoices/${v.data.data.id}/view`),f.value=!1}).catch(v=>{f.value=!1})}return(s,v)=>{const g=d("BaseBreadcrumbItem"),L=d("BaseBreadcrumb"),F=d("BaseButton"),O=d("router-link"),A=d("BaseIcon"),j=d("BasePageHeader"),l=d("BaseScrollPane"),ee=d("BasePage");return I(),Y(Z,null,[t(ye),t(Ie),t(he),S.value&&!e(b)?(I(),p(_e,{key:0,store:e(a),"store-prop":"newRecurringInvoice","is-edit":e($),customer:e(a).newRecurringInvoice.customer},null,8,["store","is-edit","customer"])):h("",!0),t(ee,{class:"relative invoice-create-page"},{default:u(()=>[m("form",{onSubmit:fe(r,["prevent"])},[t(j,{title:e(V)},{actions:u(()=>[t(O,{to:`/invoices/pdf/${e(a).newRecurringInvoice.unique_hash}`},{default:u(()=>[s.$route.name==="invoices.edit"?(I(),p(F,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:u(()=>[m("span",Ue,k(s.$t("general.view_pdf")),1)]),_:1})):h("",!0)]),_:1},8,["to"]),t(F,{loading:e(f),disabled:e(f),variant:"primary",type:"submit"},{left:u(ne=>[e(f)?h("",!0):(I(),p(A,{key:0,name:"SaveIcon",class:me(ne.class)},null,8,["class"]))]),default:u(()=>[Q(" "+k(s.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:u(()=>[t(L,null,{default:u(()=>[t(g,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(g,{title:s.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(I(),p(g,{key:0,title:s.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(I(),p(g,{key:1,title:e(V),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),m("div",Ee,[t(Ne,{v:e(_),"is-loading":e(b),"is-edit":e($)},null,8,["v","is-loading","is-edit"])]),t(l,null,{default:u(()=>[t(be,{currency:e(a).newRecurringInvoice.currency,"is-loading":e(b),"item-validation-scope":z,store:e(a),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),m("div",De,[m("div",xe,[t(we,{store:e(a),"store-prop":"newRecurringInvoice",fields:x.value,type:"Invoice"},null,8,["store","fields"]),t(Se,{type:"Invoice","is-edit":e($),"is-loading":e(b),store:e(a),"store-prop":"newRecurringInvoice","custom-field-scope":z,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(pe,{store:e(a),"store-prop":"newRecurringInvoice"},null,8,["store"])]),t($e,{currency:e(a).newRecurringInvoice.currency,"is-loading":e(b),store:e(a),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Ze as default};
