import{aR as Ie,a8 as Be,a7 as he,u as Ce,M as ke,f as v,v as Re,e as Ve,H as $e,k,a9 as Ee,aa as Se,X as Te,r as o,o as I,m as B,w as l,a,ac as R,ad as V,l as r,J as $,p as m,t as _,Q as h,K as H,a6 as j,b as p}from"./main-ChW8_T14.js";import{_ as Ne}from"./SendInvoiceModal-eHXeT8a0.js";import{_ as Ae}from"./RecurringInvoiceIndexDropdown-CXTsqvXZ.js";import{_ as we}from"./MoonwalkerIcon-C1_4rtRM.js";import{u as xe}from"./category-e7sXz5yx.js";import"./mail-driver-D2Pi8Bls.js";const De=p("div",{class:"hidden w-8 h-0 mx-4 border border-gray-400 border-solid xl:block",style:{"margin-top":"1.5rem"}},null,-1),Le={class:"relative table-container"},Fe={class:"relative flex items-center justify-between h-10 mt-5 list-none border-b-2 border-gray-200 border-solid"},Oe={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Ue={class:"absolute items-center left-6 top-2.5 select-none"},Pe={class:"relative block"},Xe={__name:"Index",setup(Ge){const W=xe(),c=Ie();Be();const z=he(),x=Ce(),E=ke(),C=v(null),{t:i}=Re.useI18n(),b=v(!1),D=v(["ACTIVE","ON_HOLD","ALL"]),S=v(!0),f=v("recurring-invoices.all");Ve();const L=v([]),T=v(!1);async function X(e=void 0){var u;T.value=!0;const n=await W.fetchCategories({search:e,type:"recurringInvoice"});n.data.data.length&&(L.value=((u=n.data)==null?void 0:u.data)||[]),T.value=!1}let s=$e({customer_id:"",category_id:null,status:"",from_date:"",to_date:""});const F=k(()=>!c.totalRecurringInvoices&&!S.value),O=k({get:()=>c.selectedRecurringInvoices,set:e=>c.selectRecurringInvoice(e)}),J=k(()=>[{key:"checkbox",thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"starts_at",label:i("recurring_invoices.starts_at"),thClass:"extra",tdClass:"font-medium"},{key:"customer",label:i("invoices.customer")},{key:"category.name",label:i("categories.label"),thClass:"extra",tdClass:"cursor-pointer font-medium text-primary-500"},{key:"frequency",label:i("recurring_invoices.frequency.title")},{key:"status",label:i("invoices.status")},{key:"total",label:i("invoices.total")},{key:"actions",label:i("recurring_invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);Ee(s,()=>{te()},{debounce:500}),Se(()=>{c.selectAllField&&c.selectAllRecurringInvoices()});const K=k(()=>D.value.findIndex(e=>e===s.status));function Q(){return E.hasAbilities([h.DELETE_RECURRING_INVOICE,h.EDIT_RECURRING_INVOICE,h.VIEW_RECURRING_INVOICE])}function Y(e){const n=c.frequencies.find(u=>u.value===e);return n?n.label:`CUSTOM: ${e}`}function N(){C.value&&C.value.refresh()}Te(()=>{X()});async function Z({page:e,filter:n,sort:u}){let g={customer_id:s.customer_id,category_id:s.category_id,status:s.status,from_date:s.from_date,to_date:s.to_date,orderByField:u.fieldName||"created_at",orderBy:u.order||"desc",page:e};S.value=!0;let d=await c.fetchRecurringInvoices(g);return S.value=!1,{data:d.data.data,pagination:{totalPages:d.data.meta.last_page,currentPage:e,totalCount:d.data.meta.total,limit:10}}}function ee(e){if(f.value==e.title)return!0;switch(f.value=e.title,e.title){case i("recurring_invoices.active"):s.status="ACTIVE";break;case i("recurring_invoices.on_hold"):s.status="ON_HOLD";break;case i("recurring_invoices.all"):s.status="ALL";break}}function te(){c.$patch(e=>{e.selectedRecurringInvoices=[],e.selectAllField=!1}),N()}function U(){s.customer_id="",s.category_id=null,s.status="",s.from_date="",s.to_date="",s.invoice_number="",f.value=i("general.all")}async function ae(e=null){z.openDialog({title:i("general.are_you_sure"),message:i("invoices.confirm_delete"),yesLabel:i("general.ok"),noLabel:i("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async n=>{n&&await c.deleteMultipleRecurringInvoices(e).then(u=>{u.data.success?(N(),c.$patch(g=>{g.selectedRecurringInvoices=[],g.selectAllField=!1}),x.showNotification({type:"success",message:i("recurring_invoices.deleted_message",2)})):u.data.error&&x.showNotification({type:"error",message:u.data.message})})})}function le(){b.value&&U(),b.value=!b.value}async function ne(e,n){s.status="",N()}function se(e){switch(e){case"ACTIVE":f.value=i("recurring_invoices.active");break;case"ON_HOLD":f.value=i("recurring_invoices.on_hold");break;case"ALL":f.value=i("recurring_invoices.all");break}}return(e,n)=>{const u=o("BaseBreadcrumbItem"),g=o("BaseBreadcrumb"),d=o("BaseIcon"),A=o("BaseButton"),P=o("router-link"),oe=o("BasePageHeader"),re=o("BaseCustomerSelectInput"),y=o("BaseInputGroup"),ie=o("BaseTreeSelect"),ce=o("BaseMultiselect"),G=o("BaseDatePicker"),ue=o("BaseFilterWrapper"),de=o("BaseEmptyPlaceholder"),w=o("BaseTab"),me=o("BaseTabGroup"),_e=o("BaseDropdownItem"),ve=o("BaseDropdown"),M=o("BaseCheckbox"),q=o("BaseText"),fe=o("BaseRecurringInvoiceStatusBadge"),ge=o("BaseFormatMoney"),pe=o("BaseTable"),be=o("BasePage");return I(),B(be,null,{default:l(()=>[a(Ne),a(oe,{title:e.$t("recurring_invoices.title")},{actions:l(()=>[R(a(A,{variant:"primary-outline",onClick:le},{right:l(t=>[b.value?(I(),B(d,{key:1,name:"XIcon",class:$(t.class)},null,8,["class"])):(I(),B(d,{key:0,name:"FilterIcon",class:$(t.class)},null,8,["class"]))]),default:l(()=>[m(_(e.$t("general.filter"))+" ",1)]),_:1},512),[[V,r(c).totalRecurringInvoices]]),r(E).hasAbilities(r(h).CREATE_RECURRING_INVOICE)?(I(),B(P,{key:0,to:"recurring-invoices/create"},{default:l(()=>[a(A,{variant:"primary",class:"ml-4"},{left:l(t=>[a(d,{name:"PlusIcon",class:$(t.class)},null,8,["class"])]),default:l(()=>[m(" "+_(e.$t("recurring_invoices.new_invoice")),1)]),_:1})]),_:1})):H("",!0)]),default:l(()=>[a(g,null,{default:l(()=>[a(u,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),a(u,{title:e.$t("recurring_invoices.invoice",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),R(a(ue,{onClear:U},{default:l(()=>[a(y,{label:e.$t("customers.customer",1)},{default:l(()=>[a(re,{modelValue:r(s).customer_id,"onUpdate:modelValue":n[0]||(n[0]=t=>r(s).customer_id=t),placeholder:e.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:e.$t("categories.label"),class:"text-left"},{default:l(()=>[a(ie,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:e.$t("categories.select_a_category"),"parent-prop":"parent_id",options:L.value,loading:T.value,modelValue:r(s).category_id,"onUpdate:modelValue":n[1]||(n[1]=t=>r(s).category_id=t)},null,8,["placeholder","options","loading","modelValue"])]),_:1},8,["label"]),a(y,{label:e.$t("recurring_invoices.status")},{default:l(()=>[a(ce,{modelValue:r(s).status,"onUpdate:modelValue":[n[2]||(n[2]=t=>r(s).status=t),se],options:D.value,searchable:"",placeholder:e.$t("general.select_a_status"),onRemove:n[3]||(n[3]=t=>ne())},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(y,{label:e.$t("general.from")},{default:l(()=>[a(G,{modelValue:r(s).from_date,"onUpdate:modelValue":n[4]||(n[4]=t=>r(s).from_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),De,a(y,{label:e.$t("general.to")},{default:l(()=>[a(G,{modelValue:r(s).to_date,"onUpdate:modelValue":n[5]||(n[5]=t=>r(s).to_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},512),[[V,b.value]]),R(a(de,{title:e.$t("recurring_invoices.no_invoices"),description:e.$t("recurring_invoices.list_of_invoices")},j({default:l(()=>[a(we,{class:"mt-5 mb-4"})]),_:2},[r(E).hasAbilities(r(h).CREATE_RECURRING_INVOICE)?{name:"actions",fn:l(()=>[a(A,{variant:"primary-outline",onClick:n[6]||(n[6]=t=>e.$router.push("/admin/recurring-invoices/create"))},{left:l(t=>[a(d,{name:"PlusIcon",class:$(t.class)},null,8,["class"])]),default:l(()=>[m(" "+_(e.$t("recurring_invoices.add_new_invoice")),1)]),_:1})]),key:"0"}:void 0]),1032,["title","description"]),[[V,F.value]]),R(p("div",Le,[p("div",Fe,[a(me,{class:"-mb-5","default-index":K.value,onChange:ee},{default:l(()=>[a(w,{title:e.$t("recurring_invoices.all"),filter:"ALL"},null,8,["title"]),a(w,{title:e.$t("recurring_invoices.active"),filter:"ACTIVE"},null,8,["title"]),a(w,{title:e.$t("recurring_invoices.on_hold"),filter:"ON_HOLD"},null,8,["title"])]),_:1},8,["default-index"]),r(c).selectedRecurringInvoices.length?(I(),B(ve,{key:0,class:"absolute float-right"},{activator:l(()=>[p("span",Oe,[m(_(e.$t("general.actions"))+" ",1),a(d,{name:"ChevronDownIcon",class:"h-5"})])]),default:l(()=>[a(_e,{onClick:n[7]||(n[7]=t=>ae())},{default:l(()=>[a(d,{name:"TrashIcon",class:"mr-3 text-gray-600"}),m(" "+_(e.$t("general.delete")),1)]),_:1})]),_:1})):H("",!0)]),a(pe,{ref_key:"table",ref:C,data:Z,columns:J.value,"placeholder-count":r(c).totalRecurringInvoices>=20?10:5,class:"mt-10"},j({header:l(()=>[p("div",Ue,[a(M,{modelValue:r(c).selectAllField,"onUpdate:modelValue":n[8]||(n[8]=t=>r(c).selectAllField=t),variant:"primary",onChange:r(c).selectAllRecurringInvoices},null,8,["modelValue","onChange"])])]),"cell-checkbox":l(({row:t})=>[p("div",Pe,[a(M,{id:t.id,modelValue:O.value,"onUpdate:modelValue":n[9]||(n[9]=ye=>O.value=ye),value:t.data.id},null,8,["id","modelValue","value"])])]),"cell-starts_at":l(({row:t})=>[m(_(t.data.formatted_starts_at),1)]),"cell-customer":l(({row:t})=>[a(P,{to:{path:`recurring-invoices/${t.data.id}/view`}},{default:l(()=>[a(q,{text:t.data.customer.name,length:30,tag:"span",class:"font-medium text-primary-500 flex flex-col"},null,8,["text"]),a(q,{text:t.data.customer.contact_name?t.data.customer.contact_name:"",length:30,tag:"span",class:"text-xs text-gray-400"},null,8,["text"])]),_:2},1032,["to"])]),"cell-frequency":l(({row:t})=>[m(_(Y(t.data.frequency)),1)]),"cell-status":l(({row:t})=>[a(fe,{status:t.data.status,class:"px-3 py-1"},{default:l(()=>[m(_(t.data.status),1)]),_:2},1032,["status"])]),"cell-total":l(({row:t})=>[a(ge,{amount:t.data.total,currency:t.data.customer.currency},null,8,["amount","currency"])]),_:2},[Q?{name:"cell-actions",fn:l(({row:t})=>[a(Ae,{row:t.data,table:C.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[V,!F.value]])]),_:1})}}};export{Xe as default};
