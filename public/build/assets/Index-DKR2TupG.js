import{au as ge,a6 as Ee,M as ve,f,v as ye,e as Be,H as he,k as F,a8 as Te,a9 as Ce,W as ke,r as n,o as E,m as v,w as s,a,ab as k,ac as I,l as r,J as h,p,t as _,Q as b,K as M,b as y,a5 as Ie}from"./main-DmfySYkn.js";import{_ as Se}from"./ObservatoryIcon-B0RWwQO9.js";import{_ as $e}from"./EstimateIndexDropdown-CsRmvB0F.js";import{_ as Ve}from"./SendEstimateModal-BG2YeDXq.js";import{_ as Ae}from"./CalendarModal-BxsvwVZ7.js";import{u as De}from"./category-uu6siVCP.js";import"./mail-driver-Cna_lYaR.js";const we=y("div",{class:"hidden w-8 h-0 mx-4 border border-gray-400 border-solid xl:block",style:{"margin-top":"1.5rem"}},null,-1),Fe={class:"relative table-container"},Me={class:"relative flex items-center justify-between h-10 mt-5 list-none border-b-2 border-gray-200 border-solid"},Pe={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Re={class:"absolute items-center left-6 top-2.5 select-none"},xe={class:"relative block"},Oe={__name:"Index",setup(Ne){const H=De(),u=ge(),L=Ee(),T=ve(),C=f(null),{t:i}=ye.useI18n(),B=f(!1),j=f(["DRAFT","SENT","VIEWED","EXPIRED","ACCEPTED","REJECTED"]),P=f([]),S=f(!1);async function J(e=void 0){var m;S.value=!0;const o=await H.fetchCategories({search:e,type:"estimate"});o.data.data.length&&(P.value=((m=o.data)==null?void 0:m.data)||[]),S.value=!1}const $=f(!0),d=f("general.draft");Be();let l=he({customer_id:"",category_id:null,status:"",from_date:"",to_date:"",estimate_number:""});const R=F(()=>!u.totalEstimateCount&&!$.value),x=F({get:()=>u.selectedEstimates,set:e=>{u.selectEstimate(e)}}),O=F(()=>[{key:"checkbox",thClass:"extra w-10 pr-0",sortable:!1,tdClass:"font-medium text-gray-900 pr-0"},{key:"estimate_date",label:i("estimates.date"),thClass:"extra",tdClass:"font-medium text-gray-500"},{key:"estimate_number",label:i("estimates.number",2)},{key:"name",label:i("estimates.customer")},{key:"category.name",label:i("categories.label"),thClass:"extra",tdClass:"cursor-pointer font-medium text-primary-500"},{key:"status",label:i("estimates.status")},{key:"total",label:i("estimates.total"),tdClass:"font-medium text-gray-900"},{key:"actions",tdClass:"text-right text-sm font-medium pl-0",thClass:"text-right pl-0",sortable:!1}]);Te(l,()=>{Q()},{debounce:500}),Ce(()=>{u.selectAllField&&u.selectAllEstimates()});function X(){return T.hasAbilities([b.CREATE_ESTIMATE,b.EDIT_ESTIMATE,b.VIEW_ESTIMATE,b.SEND_ESTIMATE])}async function z(e,o){l.status="",V()}function V(){C.value&&C.value.refresh()}async function q({page:e,filter:o,sort:m}){let A={customer_id:l.customer_id,category_id:l.category_id,status:l.status,from_date:l.from_date,to_date:l.to_date,estimate_number:l.estimate_number,orderByField:m.fieldName||"created_at",orderBy:m.order||"desc",page:e};$.value=!0;let c=await u.fetchEstimates(A);return $.value=!1,{data:c.data.data,pagination:{totalPages:c.data.meta.last_page,currentPage:e,totalCount:c.data.meta.total,limit:10}}}function K(e){if(d.value==e.title)return!0;switch(d.value=e.title,e.title){case i("general.draft"):l.status="DRAFT";break;case i("general.sent"):l.status="SENT";break;default:l.status="";break}}function Q(){u.$patch(e=>{e.selectedEstimates=[],e.selectAllField=!1}),V()}function N(){l.customer_id="",l.status="",l.from_date="",l.category_id=null,l.to_date="",l.estimate_number="",d.value=i("general.all")}function Y(){B.value&&N(),B.value=!B.value}async function Z(){L.openDialog({title:i("general.are_you_sure"),message:i("estimates.confirm_delete"),yesLabel:i("general.ok"),noLabel:i("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(e=>{e&&u.deleteMultipleEstimates().then(o=>{V(),o.data&&u.$patch(m=>{m.selectedEstimates=[],m.selectAllField=!1})})})}function ee(e){switch(e){case"DRAFT":d.value=i("general.draft");break;case"SENT":d.value=i("general.sent");break;case"VIEWED":d.value=i("estimates.viewed");break;case"EXPIRED":d.value=i("estimates.expired");break;case"ACCEPTED":d.value=i("estimates.accepted");break;case"REJECTED":d.value=i("estimates.rejected");break;default:d.value=i("general.all");break}}return ke(()=>{J()}),(e,o)=>{const m=n("BaseBreadcrumbItem"),A=n("BaseBreadcrumb"),c=n("BaseIcon"),D=n("BaseButton"),U=n("router-link"),te=n("BasePageHeader"),ae=n("BaseCustomerSelectInput"),g=n("BaseInputGroup"),se=n("BaseTreeSelect"),le=n("BaseMultiselect"),W=n("BaseDatePicker"),oe=n("BaseInput"),ne=n("BaseFilterWrapper"),re=n("BaseEmptyPlaceholder"),w=n("BaseTab"),ie=n("BaseTabGroup"),ue=n("BaseDropdownItem"),me=n("BaseDropdown"),G=n("BaseCheckbox"),ce=n("BaseText"),de=n("BaseEstimateStatusBadge"),pe=n("BaseFormatMoney"),_e=n("BaseTable"),fe=n("BasePage");return E(),v(fe,null,{default:s(()=>[a(Ve),a(Ae),a(te,{title:e.$t("estimates.title")},{actions:s(()=>[k(a(D,{variant:"primary-outline",onClick:Y},{right:s(t=>[B.value?(E(),v(c,{key:1,name:"XIcon",class:h(t.class)},null,8,["class"])):(E(),v(c,{key:0,class:h(t.class),name:"FilterIcon"},null,8,["class"]))]),default:s(()=>[p(_(e.$t("general.filter"))+" ",1)]),_:1},512),[[I,r(u).totalEstimateCount]]),r(T).hasAbilities(r(b).CREATE_ESTIMATE)?(E(),v(U,{key:0,to:"estimates/create"},{default:s(()=>[a(D,{variant:"primary",class:"ml-4"},{left:s(t=>[a(c,{name:"PlusIcon",class:h(t.class)},null,8,["class"])]),default:s(()=>[p(" "+_(e.$t("estimates.new_estimate")),1)]),_:1})]),_:1})):M("",!0)]),default:s(()=>[a(A,null,{default:s(()=>[a(m,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),a(m,{title:e.$t("estimates.estimate",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),k(a(ne,{"row-on-xl":!0,onClear:N},{default:s(()=>[a(g,{label:e.$t("customers.customer",1)},{default:s(()=>[a(ae,{modelValue:r(l).customer_id,"onUpdate:modelValue":o[0]||(o[0]=t=>r(l).customer_id=t),placeholder:e.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(g,{label:e.$t("categories.label"),class:"text-left"},{default:s(()=>[a(se,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:e.$t("expenses.categories.select_a_category"),"parent-prop":"parent_id",options:P.value,loading:S.value,modelValue:r(l).category_id,"onUpdate:modelValue":o[1]||(o[1]=t=>r(l).category_id=t)},null,8,["placeholder","options","loading","modelValue"])]),_:1},8,["label"]),a(g,{label:e.$t("estimates.status")},{default:s(()=>[a(le,{modelValue:r(l).status,"onUpdate:modelValue":[o[2]||(o[2]=t=>r(l).status=t),ee],options:j.value,searchable:"",placeholder:e.$t("general.select_a_status"),onRemove:o[3]||(o[3]=t=>z())},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(g,{label:e.$t("general.from")},{default:s(()=>[a(W,{modelValue:r(l).from_date,"onUpdate:modelValue":o[4]||(o[4]=t=>r(l).from_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),we,a(g,{label:e.$t("general.to")},{default:s(()=>[a(W,{modelValue:r(l).to_date,"onUpdate:modelValue":o[5]||(o[5]=t=>r(l).to_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),a(g,{label:e.$t("estimates.estimate_number")},{default:s(()=>[a(oe,{modelValue:r(l).estimate_number,"onUpdate:modelValue":o[6]||(o[6]=t=>r(l).estimate_number=t)},{left:s(t=>[a(c,{name:"HashtagIcon",class:h(t.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},512),[[I,B.value]]),k(a(re,{title:e.$t("estimates.no_estimates"),description:e.$t("estimates.list_of_estimates")},{actions:s(()=>[r(T).hasAbilities(r(b).CREATE_ESTIMATE)?(E(),v(D,{key:0,variant:"primary-outline",onClick:o[7]||(o[7]=t=>e.$router.push("/admin/estimates/create"))},{left:s(t=>[a(c,{name:"PlusIcon",class:h(t.class)},null,8,["class"])]),default:s(()=>[p(" "+_(e.$t("estimates.add_new_estimate")),1)]),_:1})):M("",!0)]),default:s(()=>[a(Se,{class:"mt-5 mb-4"})]),_:1},8,["title","description"]),[[I,R.value]]),k(y("div",Fe,[y("div",Me,[a(ie,{class:"-mb-5",onChange:K},{default:s(()=>[a(w,{title:e.$t("general.all"),filter:""},null,8,["title"]),a(w,{title:e.$t("general.draft"),filter:"DRAFT"},null,8,["title"]),a(w,{title:e.$t("general.sent"),filter:"SENT"},null,8,["title"])]),_:1}),r(u).selectedEstimates.length&&r(T).hasAbilities(r(b).DELETE_ESTIMATE)?(E(),v(me,{key:0,class:"absolute float-right"},{activator:s(()=>[y("span",Pe,[p(_(e.$t("general.actions"))+" ",1),a(c,{name:"ChevronDownIcon"})])]),default:s(()=>[a(ue,{onClick:Z},{default:s(()=>[a(c,{name:"TrashIcon",class:"mr-3 text-gray-600"}),p(" "+_(e.$t("general.delete")),1)]),_:1})]),_:1})):M("",!0)]),a(_e,{ref_key:"tableComponent",ref:C,data:q,columns:O.value,"placeholder-count":r(u).totalEstimateCount>=20?10:5,class:"mt-10"},Ie({header:s(()=>[y("div",Re,[a(G,{modelValue:r(u).selectAllField,"onUpdate:modelValue":o[8]||(o[8]=t=>r(u).selectAllField=t),variant:"primary",onChange:r(u).selectAllEstimates},null,8,["modelValue","onChange"])])]),"cell-checkbox":s(({row:t})=>[y("div",xe,[a(G,{id:t.id,modelValue:x.value,"onUpdate:modelValue":o[9]||(o[9]=be=>x.value=be),value:t.data.id},null,8,["id","modelValue","value"])])]),"cell-estimate_date":s(({row:t})=>[p(_(t.data.formatted_estimate_date),1)]),"cell-estimate_number":s(({row:t})=>[a(U,{to:{path:`estimates/${t.data.id}/view`},class:"font-medium text-primary-500"},{default:s(()=>[p(_(t.data.estimate_number),1)]),_:2},1032,["to"])]),"cell-name":s(({row:t})=>[a(ce,{text:t.data.customer.name,length:30},null,8,["text"])]),"cell-status":s(({row:t})=>[a(de,{status:t.data.status,class:"px-3 py-1"},{default:s(()=>[p(_(t.data.status),1)]),_:2},1032,["status"])]),"cell-total":s(({row:t})=>[a(pe,{amount:t.data.total,currency:t.data.customer.currency},null,8,["amount","currency"])]),_:2},[X()?{name:"cell-actions",fn:s(({row:t})=>[a($e,{row:t.data,table:C.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[I,!R.value]])]),_:1})}}};export{Oe as default};
