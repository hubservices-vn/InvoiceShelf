import{F as A,v as K,f as m,k as I,g as b,h as S,I as O,ah as P,j as X,z as q,r as d,o as N,m as U,w as u,b as $,p as V,t as w,l as a,a as n,q as H,J as Q,K as W}from"./main-CO79g86p.js";import{u as Y}from"./category-R7YScaiA.js";const Z={class:"flex justify-between w-full"},ee={class:"p-8 sm:p-6"},ae={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid border-modal-bg"},ne={__name:"CategoryModal",setup(te){const r=Y(),l=A(),{t:v}=K.useI18n(),p=m(!1),f=m([]),c=m(null),C=m(null);let g=m(!1);const B=m([]),k=I(()=>({currentCategory:{name:{required:b.withMessage(v("validation.required"),S),minLength:b.withMessage(v("validation.name_min_length",{count:3}),O(3))},type:{required:b.withMessage(v("validation.required"),S)},description:{maxLength:b.withMessage(v("validation.description_maxlength",{count:255}),P(255))}}})),s=X(k,I(()=>r)),x=I(()=>{var t,e;return(t=l.data)!=null&&t.type&&(r.currentCategory.type=(e=l.data)==null?void 0:e.type),l.active||(f.value=[],c.value=null,C.value=null,p.value=!1),l.active&&l.componentName==="CategoryModal"});async function F(){if(s.value.currentCategory.$touch(),s.value.currentCategory.$invalid)return!0;const t=r.isEdit?r.updateCategory:r.addCategory;g.value=!0;const e=await t(r.currentCategory);if(g.value=!1,e.data.data&&(c.value||p.value)){let i=new FormData;c.value&&i.append("category_image",JSON.stringify({name:C.value,data:c.value})),p.value&&i.append("is_category_image_removed",p.value),await r.updateCategoryImage(e.data.data.id,i),c.value=null,p.value=!1}l.refreshData&&l.refreshData(),_()}function _(){l.closeModal(),setTimeout(()=>{r.$reset(),s.value.$reset()},300)}function T(t,e,i,h){C.value=h.name,c.value=e}function D(){c.value=null,C.value=null,p.value=!0}return q(()=>r.currentCategory.type,t=>{if(!t){B.value=[];return}l.data&&(l.data.type=t),r.fetchCategories({limit:"all",type:t}).then(e=>{var i;B.value=((i=e.data)==null?void 0:i.data)||[]})}),q(()=>r.currentCategory.image_url,t=>{t&&(f.value=[{image:t}])}),(t,e)=>{const i=d("BaseIcon"),h=d("BaseInput"),y=d("BaseInputGroup"),j=d("BaseMultiselect"),G=d("BaseTreeSelect"),L=d("BaseFileUploader"),z=d("BaseTextarea"),R=d("BaseInputGrid"),M=d("BaseButton"),E=d("BaseModal");return N(),U(E,{show:x.value,onClose:_},{header:u(()=>[$("div",Z,[V(w(a(l).title)+" ",1),n(i,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:_})])]),default:u(()=>[$("form",{action:"",onSubmit:H(F,["prevent"])},[$("div",ee,[n(R,{layout:"one-column"},{default:u(()=>[n(y,{label:t.$t("expenses.category"),error:a(s).currentCategory.name.$error&&a(s).currentCategory.name.$errors[0].$message,required:""},{default:u(()=>[n(h,{modelValue:a(r).currentCategory.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a(r).currentCategory.name=o),invalid:a(s).currentCategory.name.$error,type:"text",onInput:e[1]||(e[1]=o=>a(s).currentCategory.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),n(y,{label:t.$t("categories.type"),error:a(s).currentCategory.type.$error&&a(s).currentCategory.type.$errors[0].$message,required:""},{default:u(()=>{var o;return[n(j,{modelValue:a(r).currentCategory.type,"onUpdate:modelValue":e[2]||(e[2]=J=>a(r).currentCategory.type=J),options:a(r).categoryItems,"value-prop":"id",disabled:!!((o=a(l).data)!=null&&o.type),searchable:"",placeholder:t.$t("categories.select_type"),"max-height":200,class:"mt-1 md:mt-0"},null,8,["modelValue","options","disabled","placeholder"])]}),_:1},8,["label","error"]),n(y,{label:t.$t("categories.parent")},{default:u(()=>[n(G,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:t.$t("categories.select_parent"),"parent-prop":"parent_id",options:B.value,modelValue:a(r).currentCategory.parent_id,"onUpdate:modelValue":e[3]||(e[3]=o=>a(r).currentCategory.parent_id=o)},null,8,["placeholder","options","modelValue"])]),_:1},8,["label"]),n(y,{label:t.$t("categories.image")},{default:u(()=>[n(L,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=o=>f.value=o),base64:"",onChange:T,onRemove:D},null,8,["modelValue"])]),_:1},8,["label"]),n(y,{label:t.$t("categories.description"),error:a(s).currentCategory.description.$error&&a(s).currentCategory.description.$errors[0].$message},{default:u(()=>[n(z,{modelValue:a(r).currentCategory.description,"onUpdate:modelValue":e[5]||(e[5]=o=>a(r).currentCategory.description=o),rows:"4",cols:"50",onInput:e[6]||(e[6]=o=>a(s).currentCategory.description.$touch())},null,8,["modelValue"])]),_:1},8,["label","error"])]),_:1})]),$("div",ae,[n(M,{type:"button",variant:"primary-outline",class:"mr-3 text-sm",onClick:_},{default:u(()=>[V(w(t.$t("general.cancel")),1)]),_:1}),n(M,{loading:a(g),disabled:a(g),variant:"primary",type:"submit"},{left:u(o=>[a(g)?W("",!0):(N(),U(i,{key:0,name:"SaveIcon",class:Q(o.class)},null,8,["class"]))]),default:u(()=>[V(" "+w(a(r).isEdit?t.$t("general.update"):t.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)]),_:1},8,["show"])}}};export{ne as _};
