import{v as F,F as K,as as N,f as h,W as O,r as c,o as _,c as D,a as t,b as S,l as e,w as l,p as U,t as P,N as j,E as W,ad as Q,ax as X,L as Z,e as ee,k as B,g as y,h as k,ah as te,af as ne,V as oe,j as ae,z as ie,m as $,K as M,J as se,q as le,P as ce}from"./main-DmfySYkn.js";import{_ as re,a as de,b as ue,c as me,d as ve,e as ge,f as pe}from"./SalesTax-DpAf9-sM.js";import{_ as _e}from"./ExchangeRateConverter-DERMnG61.js";import{_ as fe}from"./CategoryModal-BBkGjLI0.js";import{u as Ie}from"./category-uu6siVCP.js";import{_ as ye}from"./CreateCustomFields-DscmJu8O.js";import{_ as we}from"./TaxTypeModal-DwZqpVWm.js";import"./DragIcon-BCmQuN3q.js";import"./SelectNotePopup-xqpJezVG.js";import"./NoteModal-BoqnMb_B.js";import"./payment-DZQO564C.js";import"./exchange-rate-y28GgBm4.js";import"./dynamic-import-helper-BheWnx7M.js";const be={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},Be={__name:"InvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(a){const{t:n}=F.useI18n(),C=K(),L=Ie(),r=N();function d(){C.openModal({title:n("settings.category.add_category"),componentName:"CategoryModal",size:"sm",refreshData:v,data:{type:"invoice"}})}const w=h([]),b=h(!1);async function v(u=void 0){var m;b.value=!0;const s=await L.fetchCategories({search:u,type:"invoice"});s.data.data.length&&(w.value=((m=s.data)==null?void 0:m.data)||[]),b.value=!1}return O(()=>{v()}),(u,s)=>{const m=c("BaseCustomerSelectPopup"),V=c("BaseDatePicker"),f=c("BaseInputGroup"),g=c("BaseInput"),x=c("BaseIcon"),I=c("BaseSelectAction"),q=c("BaseTreeSelect"),o=c("BaseInputGrid");return _(),D(j,null,[t(fe),S("div",be,[t(m,{modelValue:e(r).newInvoice.customer,"onUpdate:modelValue":s[0]||(s[0]=i=>e(r).newInvoice.customer=i),valid:a.v.customer_id,"content-loading":a.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),t(o,{class:"col-span-12 lg:col-span-7"},{default:l(()=>[t(f,{label:u.$t("invoices.invoice_date"),"content-loading":a.isLoading,required:"",error:a.v.invoice_date.$error&&a.v.invoice_date.$errors[0].$message},{default:l(()=>[t(V,{modelValue:e(r).newInvoice.invoice_date,"onUpdate:modelValue":s[1]||(s[1]=i=>e(r).newInvoice.invoice_date=i),"content-loading":a.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(f,{label:u.$t("invoices.due_date"),"content-loading":a.isLoading},{default:l(()=>[t(V,{modelValue:e(r).newInvoice.due_date,"onUpdate:modelValue":s[2]||(s[2]=i=>e(r).newInvoice.due_date=i),"content-loading":a.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(f,{label:u.$t("invoices.invoice_number"),"content-loading":a.isLoading,error:a.v.invoice_number.$error&&a.v.invoice_number.$errors[0].$message,required:""},{default:l(()=>[t(g,{modelValue:e(r).newInvoice.invoice_number,"onUpdate:modelValue":s[3]||(s[3]=i=>e(r).newInvoice.invoice_number=i),"content-loading":a.isLoading,onInput:s[4]||(s[4]=i=>a.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(f,{label:u.$t("categories.label"),"content-loading":a.isLoading},{default:l(()=>[t(q,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:u.$t("categories.select_a_category"),"parent-prop":"parent_id",options:w.value,"content-loading":a.isLoading,loading:b.value,modelValue:e(r).newInvoice.category_id,"onUpdate:modelValue":s[5]||(s[5]=i=>e(r).newInvoice.category_id=i)},{"after-list":l(()=>[t(I,{onClick:d},{default:l(()=>[t(x,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),U(" "+P(u.$t("settings.category.add_new_category")),1)]),_:1})]),_:1},8,["placeholder","options","content-loading","loading","modelValue"])]),_:1},8,["label","content-loading"]),t(_e,{store:e(r),"store-prop":"newInvoice",v:a.v,"is-loading":a.isLoading,"is-edit":a.isEdit,"customer-currency":e(r).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])],64)}}},$e={class:"flex"},Se={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},he={class:"relative w-full lg:w-1/2 lg:mr-4"},E="newInvoice",Ue={__name:"InvoiceCreate",setup(a){const n=N(),C=W(),L=Q(),r=X(),{t:d}=F.useI18n();let w=Z(),b=ee(),v=h(!1);const u=h(!1),s=h(["customer","company","customerCustom","invoice","invoiceCustom"]);let m=B(()=>n.isFetchingInvoice||n.isFetchingInitialSettings),V=B(()=>g.value?d("invoices.edit_invoice"):d("invoices.new_invoice"));const f=B(()=>C.selectedCompanySettings.sales_tax_us_enabled==="YES"&&r.salesTaxUSEnabled);let g=B(()=>w.name==="invoices.edit");const x={invoice_date:{required:y.withMessage(d("validation.required"),k)},reference_number:{maxLength:y.withMessage(d("validation.price_maxlength"),te(255))},customer_id:{required:y.withMessage(d("validation.required"),k)},invoice_number:{required:y.withMessage(d("validation.required"),k)},exchange_rate:{required:ne(function(){return y.withMessage(d("validation.required"),k),n.showExchangeRate}),decimal:y.withMessage(d("validation.valid_exchange_rate"),oe)}},I=ae(x,B(()=>n.newInvoice),{$scope:E});L.resetCustomFields(),I.value.$reset,n.resetCurrentInvoice(),n.fetchInvoiceInitialSettings(g.value),ie(()=>n.newInvoice.customer,o=>{o&&o.currency?n.newInvoice.selectedCurrency=o.currency:n.newInvoice.selectedCurrency=C.selectedCompanyCurrency});async function q(){if(I.value.$touch(),I.value.$invalid)return!1;v.value=!0;let o=ce.cloneDeep({...n.newInvoice,sub_total:n.getSubTotal,total:n.getTotal,tax:n.getTotalTax});o.discount_per_item==="YES"?o.items.forEach((i,p)=>{i.discount_type==="fixed"&&(o.items[p].discount=i.discount*100)}):o.discount_type==="fixed"&&(o.discount=o.discount*100),!n.newInvoice.tax_per_item==="YES"&&o.taxes.length&&(o.tax_type_ids=o.taxes.map(i=>i.tax_type_id));try{const p=await(g.value?n.updateInvoice:n.addInvoice)(o);b.push(`/admin/invoices/${p.data.data.id}/view`)}catch(i){console.error(i)}v.value=!1}return(o,i)=>{const p=c("BaseBreadcrumbItem"),G=c("BaseBreadcrumb"),T=c("BaseButton"),z=c("router-link"),A=c("BaseIcon"),R=c("BasePageHeader"),Y=c("BaseScrollPane"),H=c("BasePage");return _(),D(j,null,[t(re),t(de),t(we),f.value&&(!e(m)||e(w).query.customer)?(_(),$(ue,{key:0,store:e(n),"is-edit":e(g),"store-prop":"newInvoice",customer:e(n).newInvoice.customer},null,8,["store","is-edit","customer"])):M("",!0),t(H,{class:"relative invoice-create-page"},{default:l(()=>[S("form",{onSubmit:le(q,["prevent"])},[t(R,{title:e(V)},{actions:l(()=>[o.$route.name==="invoices.edit"?(_(),$(z,{key:0,to:`/invoices/pdf/${e(n).newInvoice.unique_hash}`,target:"_blank"},{default:l(()=>[t(T,{class:"mr-3",variant:"primary-outline",type:"button"},{default:l(()=>[S("span",$e,P(o.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):M("",!0),t(T,{loading:e(v),disabled:e(v),variant:"primary",type:"submit"},{left:l(J=>[e(v)?M("",!0):(_(),$(A,{key:0,name:"SaveIcon",class:se(J.class)},null,8,["class"]))]),default:l(()=>[U(" "+P(o.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[t(G,null,{default:l(()=>[t(p,{title:o.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(p,{title:o.$t("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),o.$route.name==="invoices.edit"?(_(),$(p,{key:0,title:o.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(_(),$(p,{key:1,title:o.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),t(Be,{v:e(I),"is-loading":e(m),"is-edit":e(g)},null,8,["v","is-loading","is-edit"]),t(Y,null,{default:l(()=>[t(me,{currency:e(n).newInvoice.selectedCurrency,"is-loading":e(m),"item-validation-scope":E,store:e(n),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),S("div",Se,[S("div",he,[t(ve,{store:e(n),"store-prop":"newInvoice",fields:s.value,type:"Invoice"},null,8,["store","fields"]),t(ye,{type:"Invoice","is-edit":e(g),"is-loading":e(m),store:e(n),"store-prop":"newInvoice","custom-field-scope":E,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(ge,{store:e(n),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":u.value},null,8,["store","is-mark-as-default"])]),t(pe,{currency:e(n).newInvoice.selectedCurrency,"is-loading":e(m),store:e(n),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Ue as default};
