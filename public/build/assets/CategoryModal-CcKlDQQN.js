import{F as O,v as A,f as m,k as I,g as _,h as S,I as K,ai as P,j as X,z as N,r as d,o as q,m as U,w as u,b,p as V,t as w,l as a,a as n,q as H,J as Q,K as W}from"./main-BAQDmuOe.js";import{u as Y}from"./category-_F3kxSxc.js";const Z={class:"flex justify-between w-full"},ee={class:"p-8 sm:p-6"},ae={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid border-modal-bg"},ne={__name:"CategoryModal",setup(te){const o=Y(),s=O(),{t:y}=A.useI18n(),v=m(!1),$=m(null),c=m(null),f=m(null);let p=m(!1);const B=m([]),k=I(()=>({currentCategory:{name:{required:_.withMessage(y("validation.required"),S),minLength:_.withMessage(y("validation.name_min_length",{count:3}),K(3))},type:{required:_.withMessage(y("validation.required"),S)},description:{maxLength:_.withMessage(y("validation.description_maxlength",{count:255}),P(255))}}})),l=X(k,I(()=>o)),x=I(()=>{var t,e;return(t=s.data)!=null&&t.type&&(o.currentCategory.type=(e=s.data)==null?void 0:e.type),s.active&&s.componentName==="CategoryModal"});async function F(){if(l.value.currentCategory.$touch(),l.value.currentCategory.$invalid)return!0;const t=o.isEdit?o.updateCategory:o.addCategory;p.value=!0;const e=await t(o.currentCategory);if(p.value=!1,e.data.data&&(c.value||v.value)){let i=new FormData;i.append("category_image",JSON.stringify({name:f.value,data:c.value})),console.log(JSON.stringify({name:f.value,data:c.value})),i.append("is_category_image_removed",v.value),await o.updateCategoryImage(e.data.data.id,i),c.value=null,v.value=!1}s.refreshData&&s.refreshData(),C()}function C(){s.closeModal(),setTimeout(()=>{o.$reset(),l.value.$reset()},300)}function T(t,e,i,h){f.value=h.name,c.value=e}function D(){c.value=null,f.value=null,v.value=!0}return N(()=>o.currentCategory.type,t=>{if(!t){B.value=[];return}s.data&&(s.data.type=t),o.fetchCategories({limit:"all",type:t}).then(e=>{var i;B.value=((i=e.data)==null?void 0:i.data)||[]})}),N(()=>o.currentCategory.image_url,t=>{t&&($.value=[{image:t}])}),(t,e)=>{const i=d("BaseIcon"),h=d("BaseInput"),g=d("BaseInputGroup"),j=d("BaseMultiselect"),G=d("BaseTreeSelect"),L=d("BaseFileUploader"),z=d("BaseTextarea"),J=d("BaseInputGrid"),M=d("BaseButton"),R=d("BaseModal");return q(),U(R,{show:x.value,onClose:C},{header:u(()=>[b("div",Z,[V(w(a(s).title)+" ",1),n(i,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:C})])]),default:u(()=>[b("form",{action:"",onSubmit:H(F,["prevent"])},[b("div",ee,[n(J,{layout:"one-column"},{default:u(()=>[n(g,{label:t.$t("expenses.category"),error:a(l).currentCategory.name.$error&&a(l).currentCategory.name.$errors[0].$message,required:""},{default:u(()=>[n(h,{modelValue:a(o).currentCategory.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a(o).currentCategory.name=r),invalid:a(l).currentCategory.name.$error,type:"text",onInput:e[1]||(e[1]=r=>a(l).currentCategory.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),n(g,{label:t.$t("categories.type"),error:a(l).currentCategory.type.$error&&a(l).currentCategory.type.$errors[0].$message,required:""},{default:u(()=>{var r;return[n(j,{modelValue:a(o).currentCategory.type,"onUpdate:modelValue":e[2]||(e[2]=E=>a(o).currentCategory.type=E),options:a(o).categoryItems,"value-prop":"id",disabled:!!((r=a(s).data)!=null&&r.type),searchable:"",placeholder:t.$t("categories.select_type"),"max-height":200,class:"mt-1 md:mt-0"},null,8,["modelValue","options","disabled","placeholder"])]}),_:1},8,["label","error"]),n(g,{label:t.$t("categories.parent")},{default:u(()=>[n(G,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:t.$t("categories.select_parent"),"parent-prop":"parent_id",options:B.value,modelValue:a(o).currentCategory.parent_id,"onUpdate:modelValue":e[3]||(e[3]=r=>a(o).currentCategory.parent_id=r)},null,8,["placeholder","options","modelValue"])]),_:1},8,["label"]),n(g,{label:t.$t("categories.image")},{default:u(()=>[n(L,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=r=>$.value=r),base64:"",onChange:T,onRemove:D},null,8,["modelValue"])]),_:1},8,["label"]),n(g,{label:t.$t("categories.description"),error:a(l).currentCategory.description.$error&&a(l).currentCategory.description.$errors[0].$message},{default:u(()=>[n(z,{modelValue:a(o).currentCategory.description,"onUpdate:modelValue":e[5]||(e[5]=r=>a(o).currentCategory.description=r),rows:"4",cols:"50",onInput:e[6]||(e[6]=r=>a(l).currentCategory.description.$touch())},null,8,["modelValue"])]),_:1},8,["label","error"])]),_:1})]),b("div",ae,[n(M,{type:"button",variant:"primary-outline",class:"mr-3 text-sm",onClick:C},{default:u(()=>[V(w(t.$t("general.cancel")),1)]),_:1}),n(M,{loading:a(p),disabled:a(p),variant:"primary",type:"submit"},{left:u(r=>[a(p)?W("",!0):(q(),U(i,{key:0,name:"SaveIcon",class:Q(r.class)},null,8,["class"]))]),default:u(()=>[V(" "+w(a(o).isEdit?t.$t("general.update"):t.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)]),_:1},8,["show"])}}};export{ne as _};
