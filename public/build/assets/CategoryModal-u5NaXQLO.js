import{F as A,v as K,f as m,k as I,g as _,h as S,I as P,ai as X,j as H,z as N,r as d,o as q,m as x,w as i,b,p as V,t as w,l as t,a as n,q as Q,J as W,K as Y}from"./main-DuDaNFOP.js";import{u as Z}from"./category-CZwZaTw7.js";const ee={class:"flex justify-between w-full"},ae={class:"p-8 sm:p-6"},te={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid border-modal-bg"},le={__name:"CategoryModal",setup(oe){const o=Z(),s=A(),{t:y}=K.useI18n(),v=m(!1),$=m(null),c=m(null),f=m(null);let p=m(!1);const B=m([]),T=[{id:"item",label:"Item"},{id:"invoice",label:"Invoice"},{id:"expense",label:"Expense"},{id:"estimate",label:"Estimate"},{id:"customer",label:"Customer"}],U=I(()=>({currentCategory:{name:{required:_.withMessage(y("validation.required"),S),minLength:_.withMessage(y("validation.name_min_length",{count:3}),P(3))},type:{required:_.withMessage(y("validation.required"),S)},description:{maxLength:_.withMessage(y("validation.description_maxlength",{count:255}),X(255))}}})),l=H(U,I(()=>o)),k=I(()=>{var a,e;return(a=s.data)!=null&&a.type&&(o.currentCategory.type=(e=s.data)==null?void 0:e.type),s.active&&s.componentName==="CategoryModal"});async function F(){if(l.value.currentCategory.$touch(),l.value.currentCategory.$invalid)return!0;const a=o.isEdit?o.updateCategory:o.addCategory;p.value=!0;const e=await a(o.currentCategory);if(p.value=!1,e.data.data&&(c.value||v.value)){let u=new FormData;u.append("category_image",JSON.stringify({name:f.value,data:c.value})),console.log(JSON.stringify({name:f.value,data:c.value})),u.append("is_category_image_removed",v.value),await o.updateCategoryImage(e.data.data.id,u),c.value=null,v.value=!1}s.refreshData&&s.refreshData(),C()}function C(){s.closeModal(),setTimeout(()=>{o.$reset(),l.value.$reset()},300)}function D(a,e,u,h){f.value=h.name,c.value=e}function j(){c.value=null,f.value=null,v.value=!0}return N(()=>o.currentCategory.type,a=>{if(!a){B.value=[];return}s.data&&(s.data.type=a),o.fetchCategories({limit:"all",type:a}).then(e=>{var u;B.value=((u=e.data)==null?void 0:u.data)||[]})}),N(()=>o.currentCategory.image_url,a=>{a&&($.value=[{image:a}])}),(a,e)=>{const u=d("BaseIcon"),h=d("BaseInput"),g=d("BaseInputGroup"),E=d("BaseMultiselect"),G=d("BaseTreeSelect"),L=d("BaseFileUploader"),z=d("BaseTextarea"),J=d("BaseInputGrid"),M=d("BaseButton"),R=d("BaseModal");return q(),x(R,{show:k.value,onClose:C},{header:i(()=>[b("div",ee,[V(w(t(s).title)+" ",1),n(u,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:C})])]),default:i(()=>[b("form",{action:"",onSubmit:Q(F,["prevent"])},[b("div",ae,[n(J,{layout:"one-column"},{default:i(()=>[n(g,{label:a.$t("expenses.category"),error:t(l).currentCategory.name.$error&&t(l).currentCategory.name.$errors[0].$message,required:""},{default:i(()=>[n(h,{modelValue:t(o).currentCategory.name,"onUpdate:modelValue":e[0]||(e[0]=r=>t(o).currentCategory.name=r),invalid:t(l).currentCategory.name.$error,type:"text",onInput:e[1]||(e[1]=r=>t(l).currentCategory.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),n(g,{label:a.$t("categories.type"),error:t(l).currentCategory.type.$error&&t(l).currentCategory.type.$errors[0].$message,required:""},{default:i(()=>{var r;return[n(E,{modelValue:t(o).currentCategory.type,"onUpdate:modelValue":e[2]||(e[2]=O=>t(o).currentCategory.type=O),options:T,"value-prop":"id",disabled:!!((r=t(s).data)!=null&&r.type),searchable:"",placeholder:a.$t("categories.select_type"),"max-height":200,class:"mt-1 md:mt-0"},null,8,["modelValue","disabled","placeholder"])]}),_:1},8,["label","error"]),n(g,{label:a.$t("categories.parent")},{default:i(()=>[n(G,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:a.$t("categories.select_parent"),"parent-prop":"parent_id",options:B.value,modelValue:t(o).currentCategory.parent_id,"onUpdate:modelValue":e[3]||(e[3]=r=>t(o).currentCategory.parent_id=r)},null,8,["placeholder","options","modelValue"])]),_:1},8,["label"]),n(g,{label:a.$t("categories.image")},{default:i(()=>[n(L,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=r=>$.value=r),base64:"",onChange:D,onRemove:j},null,8,["modelValue"])]),_:1},8,["label"]),n(g,{label:a.$t("categories.description"),error:t(l).currentCategory.description.$error&&t(l).currentCategory.description.$errors[0].$message},{default:i(()=>[n(z,{modelValue:t(o).currentCategory.description,"onUpdate:modelValue":e[5]||(e[5]=r=>t(o).currentCategory.description=r),rows:"4",cols:"50",onInput:e[6]||(e[6]=r=>t(l).currentCategory.description.$touch())},null,8,["modelValue"])]),_:1},8,["label","error"])]),_:1})]),b("div",te,[n(M,{type:"button",variant:"primary-outline",class:"mr-3 text-sm",onClick:C},{default:i(()=>[V(w(a.$t("general.cancel")),1)]),_:1}),n(M,{loading:t(p),disabled:t(p),variant:"primary",type:"submit"},{left:i(r=>[t(p)?Y("",!0):(q(),x(u,{key:0,name:"SaveIcon",class:W(r.class)},null,8,["class"]))]),default:i(()=>[V(" "+w(t(o).isEdit?a.$t("general.update"):a.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)]),_:1},8,["show"])}}};export{le as _};
