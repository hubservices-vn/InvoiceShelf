import{ae as de,at as pe,au as ge,F as _e,E as ve,v as fe,L as Ie,e as ye,M as Be,f as d,k as _,j as be,Q as $e,z as Ve,X as Se,r,o as T,m as x,w as l,a as o,b as U,l as t,p as F,t as N,K as A,J as he,q as we,g as P,h as Ce,I as Me,ai as Te}from"./main-oNMlaitD.js";import{_ as xe}from"./ItemUnitModal-CoEh7hfv.js";import{_ as Ue}from"./CategoryModal-BKqFqQ1f.js";import{u as Fe}from"./category-DsCT5RS5.js";import{_ as Ne}from"./CreateCustomFields-BnCoEuz3.js";import"./dynamic-import-helper-BheWnx7M.js";const G="customFields",Re={__name:"Create",setup(Pe){de();const j=Fe(),a=pe(),k=ge(),B=_e(),Y=ve(),{t:p}=fe.useI18n(),$=Ie(),H=ye(),J=Be(),b=d(!1),V=d([]),f=d(null),S=d(null),I=d(!1),h=d(Y.selectedCompanySettings.tax_per_item);let i=d(!1);a.$reset(),te();function O(e,n,u,v){S.value=v.name,f.value=n}function X(){f.value=null,S.value=null,b.value=!0}function K(){B.openModal({title:p("settings.category.add_category"),componentName:"CategoryModal",size:"sm",refreshData:E,data:{type:"item"}})}const z=d([]),w=d(!1);async function E(e=void 0){var u;w.value=!0;const n=await j.fetchCategories({search:e,type:"item"});n.data.data.length&&(z.value=((u=n.data)==null?void 0:u.data)||[]),w.value=!1}const C=_({get:()=>a.currentItem.price/100,set:e=>{a.currentItem.price=Math.round(e*100)}}),L=_({get:()=>{var e,n;return(n=(e=a==null?void 0:a.currentItem)==null?void 0:e.taxes)==null?void 0:n.map(u=>{if(u)return{...u,tax_type_id:u.id,tax_name:u.name+" ("+u.percent+"%)"}})},set:e=>{a.currentItem.taxes=e}}),y=_(()=>$.name==="items.edit"),q=_(()=>y.value?p("items.edit_item"):p("items.new_item")),Q=_(()=>k.taxTypes.map(e=>({...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}))),W=_(()=>h.value==="YES"),Z=_(()=>({currentItem:{name:{required:P.withMessage(p("validation.required"),Ce),minLength:P.withMessage(p("validation.name_min_length",{count:2}),Me(2))},description:{maxLength:P.withMessage(p("validation.description_maxlength"),Te(65e3))}}})),m=be(Z,a,{$scope:G});async function ee(){B.openModal({title:p("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function te(){if(i.value=!0,await a.fetchItemUnits({limit:"all"}),J.hasAbilities($e.VIEW_TAX_TYPE)&&await k.fetchTaxTypes({limit:"all"}),y.value){let e=$.params.id;await a.fetchItem(e),a.currentItem.tax_per_item===1?h.value="YES":h.value="NO"}i.value=!1}async function ae(){if(m.value.$touch(),m.value.$invalid)return!1;I.value=!0;try{let n={id:$.params.id,...a.currentItem};a.currentItem&&a.currentItem.taxes&&(n.taxes=a.currentItem.taxes.map(c=>({tax_type_id:c.tax_type_id,amount:C.value*c.percent,percent:c.percent,name:c.name,collective_tax:0})));const v=await(y.value?a.updateItem:a.addItem)(n);if(v.data.data&&(f.value||b.value)){let c=new FormData;c.append("item_image",JSON.stringify({name:S.value,data:f.value})),c.append("is_item_image_removed",b.value),await a.updateItemImage(v.data.data.id,c),f.value=null,b.value=!1}I.value=!1,H.push("/admin/items"),e()}catch{I.value=!1;return}function e(){B.closeModal(),setTimeout(()=>{a.resetCurrentItem(),B.$reset(),m.value.$reset()},300)}}return Ve(()=>a.currentItem.image_url,e=>{e&&(V.value=[{image:e}])}),Se(()=>{E()}),(e,n)=>{const u=r("BaseBreadcrumbItem"),v=r("BaseBreadcrumb"),c=r("BasePageHeader"),ne=r("BaseInput"),g=r("BaseInputGroup"),M=r("BaseIcon"),D=r("BaseSelectAction"),oe=r("BaseTreeSelect"),le=r("BaseMoney"),R=r("BaseMultiselect"),se=r("BaseTextarea"),ie=r("BaseFileUploader"),re=r("BaseButton"),ue=r("BaseInputGrid"),me=r("BaseCard"),ce=r("BasePage");return T(),x(ce,null,{default:l(()=>[o(c,{title:q.value},{default:l(()=>[o(v,null,{default:l(()=>[o(u,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),o(u,{title:e.$t("items.item",2),to:"/admin/items"},null,8,["title"]),o(u,{title:q.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(xe),o(Ue),U("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:we(ae,["prevent"])},[o(me,{class:"w-full"},{default:l(()=>[o(ue,{layout:"one-column"},{default:l(()=>[o(g,{label:e.$t("items.name"),"content-loading":t(i),required:"",error:t(m).currentItem.name.$error&&t(m).currentItem.name.$errors[0].$message},{default:l(()=>[o(ne,{modelValue:t(a).currentItem.name,"onUpdate:modelValue":n[0]||(n[0]=s=>t(a).currentItem.name=s),"content-loading":t(i),invalid:t(m).currentItem.name.$error,onInput:n[1]||(n[1]=s=>t(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(g,{label:e.$t("expenses.category"),"content-loading":t(i)},{default:l(()=>[o(oe,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:e.$t("expenses.categories.select_a_category"),"parent-prop":"parent_id",options:z.value,"content-loading":t(i),loading:w.value,modelValue:t(a).currentItem.category_id,"onUpdate:modelValue":n[2]||(n[2]=s=>t(a).currentItem.category_id=s)},{"after-list":l(()=>[o(D,{onClick:K},{default:l(()=>[o(M,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),F(" "+N(e.$t("settings.category.add_new_category")),1)]),_:1})]),_:1},8,["placeholder","options","content-loading","loading","modelValue"])]),_:1},8,["label","content-loading"]),o(g,{label:e.$t("items.price"),"content-loading":t(i)},{default:l(()=>[o(le,{modelValue:C.value,"onUpdate:modelValue":n[3]||(n[3]=s=>C.value=s),"content-loading":t(i)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(g,{"content-loading":t(i),label:e.$t("items.unit")},{default:l(()=>[o(R,{modelValue:t(a).currentItem.unit_id,"onUpdate:modelValue":n[4]||(n[4]=s=>t(a).currentItem.unit_id=s),"content-loading":t(i),label:"name",options:t(a).itemUnits,"value-prop":"id",placeholder:e.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:l(()=>[o(D,{onClick:ee},{default:l(()=>[o(M,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),F(" "+N(e.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),W.value?(T(),x(g,{key:0,label:e.$t("items.taxes"),"content-loading":t(i)},{default:l(()=>[o(R,{modelValue:L.value,"onUpdate:modelValue":n[5]||(n[5]=s=>L.value=s),"content-loading":t(i),options:Q.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):A("",!0),o(g,{label:e.$t("items.description"),"content-loading":t(i),error:t(m).currentItem.description.$error&&t(m).currentItem.description.$errors[0].$message},{default:l(()=>[o(se,{modelValue:t(a).currentItem.description,"onUpdate:modelValue":n[6]||(n[6]=s=>t(a).currentItem.description=s),"content-loading":t(i),name:"description",row:2,rows:"2",onInput:n[7]||(n[7]=s=>t(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(g,{label:e.$t("categories.image")},{default:l(()=>[o(ie,{modelValue:V.value,"onUpdate:modelValue":n[8]||(n[8]=s=>V.value=s),base64:"",onChange:O,onRemove:X},null,8,["modelValue"])]),_:1},8,["label"]),U("div",null,[o(Ne,{type:"Item","grid-layout":"one-column",store:t(a),"store-prop":"currentItem","is-edit":y.value,"is-loading":t(i),"custom-field-scope":G},null,8,["store","is-edit","is-loading"])]),U("div",null,[o(re,{"content-loading":t(i),type:"submit",loading:I.value},{left:l(s=>[I.value?A("",!0):(T(),x(M,{key:0,name:"SaveIcon",class:he(s.class)},null,8,["class"]))]),default:l(()=>[F(" "+N(y.value?e.$t("items.update_item"):e.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],32)]),_:1})}}};export{Re as default};
