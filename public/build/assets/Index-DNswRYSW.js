import{v as ye,f as g,H as _e,E as fe,a6 as be,M as ve,k as P,a8 as ge,a9 as Be,W as he,r as s,o as _,m as f,w as a,a as n,ab as L,ac as W,l as i,J as B,p,t as c,Q as b,K as E,a5 as j,b as y}from"./main-CO79g86p.js";import{u as Ce}from"./payment-USkgOKPm.js";import{_ as ke}from"./CapsuleIcon-B3VuzkTI.js";import{_ as Pe,a as Ie}from"./SendPaymentModal-DEtYsDDp.js";import{u as $e}from"./category-R7YScaiA.js";import"./mail-driver-CfdoGt3d.js";const Ve={class:"relative table-container"},Te={class:"relative flex items-center justify-end h-5"},Se={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Ee={class:"absolute items-center left-6 top-2.5 select-none"},Ae={class:"relative block"},Ye={__name:"Index",setup(Me){const z=$e(),{t:r}=ye.useI18n();let v=g(!1),I=g(!0),h=g(null);const o=_e({customer_id:"",payment_mode:"",category_id:null,payment_number:""}),A=g([]),$=g(!1);async function G(t=void 0){var d;$.value=!0;const l=await z.fetchCategories({search:t,type:"payment",limit:"all"});l.data.data.length&&(A.value=((d=l.data)==null?void 0:d.data)||[]),$.value=!1}const m=Ce();fe();const R=be(),V=ve(),M=P(()=>!m.paymentTotalCount&&!I.value),J=P(()=>[{key:"status",sortable:!1,thClass:"extra w-10",tdClass:"text-left text-sm font-medium extra"},{key:"payment_date",label:r("payments.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"payment_number",label:r("payments.payment_number")},{key:"name",label:r("payments.customer")},{key:"category.name",label:r("categories.label"),thClass:"extra",tdClass:"cursor-pointer font-medium text-primary-500"},{key:"payment_mode",label:r("payments.payment_mode")},{key:"invoice_number",label:r("invoices.invoice_number")},{key:"amount",label:r("payments.amount")},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]),D=P({get:()=>m.selectedPayments,set:t=>m.selectPayment(t)}),F=P({get:()=>m.selectAllField,set:t=>m.setSelectAllState(t)});ge(o,()=>{X()},{debounce:500}),Be(()=>{m.selectAllField&&m.selectAllPayments()}),m.fetchPaymentModes({limit:"all"});async function K(t){return(await m.fetchPaymentModes({search:t})).data.data}function O(){return V.hasAbilities([b.DELETE_PAYMENT,b.EDIT_PAYMENT,b.VIEW_PAYMENT,b.SEND_PAYMENT])}async function Q({page:t,filter:l,sort:d}){let T={customer_id:o.customer_id,category_id:o.category_id,payment_method_id:o.payment_mode!==null?o.payment_mode:"",payment_number:o.payment_number,orderByField:d.fieldName||"created_at",orderBy:d.order||"desc",page:t};I.value=!0;let u=await m.fetchPayments(T);return I.value=!1,{data:u.data.data,pagination:{totalPages:u.data.meta.last_page,currentPage:t,totalCount:u.data.meta.total,limit:10}}}function N(){h.value&&h.value.refresh()}function X(){N()}function x(){o.customer_id="",o.payment_mode="",o.payment_number="",o.category_id=null}function q(){v.value&&x(),v.value=!v.value}function Z(){R.openDialog({title:r("general.are_you_sure"),message:r("payments.confirm_delete",2),yesLabel:r("general.ok"),noLabel:r("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(t=>{t&&m.deleteMultiplePayments().then(l=>{l.data.success&&N()})})}return he(()=>{G()}),(t,l)=>{const d=s("BaseBreadcrumbItem"),T=s("BaseBreadcrumb"),u=s("BaseIcon"),S=s("BaseButton"),ee=s("BasePageHeader"),te=s("BaseCustomerSelectInput"),C=s("BaseInputGroup"),ae=s("BaseTreeSelect"),ne=s("BaseInput"),le=s("BaseMultiselect"),se=s("BaseFilterWrapper"),oe=s("BaseEmptyPlaceholder"),me=s("BaseDropdownItem"),re=s("BaseDropdown"),w=s("BaseCheckbox"),ue=s("router-link"),ie=s("BaseText"),ce=s("BaseFormatMoney"),de=s("BaseTable"),pe=s("BasePage");return _(),f(pe,{class:"payments"},{default:a(()=>[n(Pe),n(ee,{title:t.$t("payments.title")},{actions:a(()=>[L(n(S,{variant:"primary-outline",onClick:q},{right:a(e=>[i(v)?(_(),f(u,{key:1,name:"XIcon",class:B(e.class)},null,8,["class"])):(_(),f(u,{key:0,class:B(e.class),name:"FilterIcon"},null,8,["class"]))]),default:a(()=>[p(c(t.$t("general.filter"))+" ",1)]),_:1},512),[[W,i(m).paymentTotalCount]]),i(V).hasAbilities(i(b).CREATE_PAYMENT)?(_(),f(S,{key:0,variant:"primary",class:"ml-4",onClick:l[0]||(l[0]=e=>t.$router.push("/admin/payments/create"))},{left:a(e=>[n(u,{name:"PlusIcon",class:B(e.class)},null,8,["class"])]),default:a(()=>[p(" "+c(t.$t("payments.add_payment")),1)]),_:1})):E("",!0)]),default:a(()=>[n(T,null,{default:a(()=>[n(d,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),n(d,{title:t.$t("payments.payment",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),n(se,{show:i(v),class:"mt-3",onClear:x},{default:a(()=>[n(C,{label:t.$t("payments.customer")},{default:a(()=>[n(te,{modelValue:o.customer_id,"onUpdate:modelValue":l[1]||(l[1]=e=>o.customer_id=e),placeholder:t.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(C,{label:t.$t("categories.label"),class:"text-left"},{default:a(()=>[n(ae,{name:"parent_id","value-prop":"id","label-prop":"name",placeholder:t.$t("categories.select_a_category"),"parent-prop":"parent_id",options:A.value,loading:$.value,modelValue:o.category_id,"onUpdate:modelValue":l[2]||(l[2]=e=>o.category_id=e)},null,8,["placeholder","options","loading","modelValue"])]),_:1},8,["label"]),n(C,{label:t.$t("payments.payment_number")},{default:a(()=>[n(ne,{modelValue:o.payment_number,"onUpdate:modelValue":l[3]||(l[3]=e=>o.payment_number=e)},{left:a(e=>[n(u,{name:"HashtagIcon",class:B(e.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),n(C,{label:t.$t("payments.payment_mode")},{default:a(()=>[n(le,{modelValue:o.payment_mode,"onUpdate:modelValue":l[4]||(l[4]=e=>o.payment_mode=e),"value-prop":"id","track-by":"name","filter-results":!1,label:"name","resolve-on-load":"",delay:500,searchable:"",options:K},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["show"]),M.value?(_(),f(oe,{key:0,title:t.$t("payments.no_payments"),description:t.$t("payments.list_of_payments")},j({default:a(()=>[n(ke,{class:"mt-5 mb-4"})]),_:2},[i(V).hasAbilities(i(b).CREATE_PAYMENT)?{name:"actions",fn:a(()=>[n(S,{variant:"primary-outline",onClick:l[5]||(l[5]=e=>t.$router.push("/admin/payments/create"))},{left:a(e=>[n(u,{name:"PlusIcon",class:B(e.class)},null,8,["class"])]),default:a(()=>[p(" "+c(t.$t("payments.add_new_payment")),1)]),_:1})]),key:"0"}:void 0]),1032,["title","description"])):E("",!0),L(y("div",Ve,[y("div",Te,[i(m).selectedPayments.length?(_(),f(re,{key:0},{activator:a(()=>[y("span",Se,[p(c(t.$t("general.actions"))+" ",1),n(u,{name:"ChevronDownIcon"})])]),default:a(()=>[n(me,{onClick:Z},{default:a(()=>[n(u,{name:"TrashIcon",class:"mr-3 text-gray-600"}),p(" "+c(t.$t("general.delete")),1)]),_:1})]),_:1})):E("",!0)]),n(de,{ref_key:"tableComponent",ref:h,data:Q,columns:J.value,"placeholder-count":i(m).paymentTotalCount>=20?10:5,class:"mt-3"},j({header:a(()=>[y("div",Ee,[n(w,{modelValue:F.value,"onUpdate:modelValue":l[6]||(l[6]=e=>F.value=e),variant:"primary",onChange:i(m).selectAllPayments},null,8,["modelValue","onChange"])])]),"cell-status":a(({row:e})=>[y("div",Ae,[n(w,{id:e.id,modelValue:D.value,"onUpdate:modelValue":l[7]||(l[7]=k=>D.value=k),value:e.data.id,variant:"primary"},null,8,["id","modelValue","value"])])]),"cell-payment_date":a(({row:e})=>[p(c(e.data.formatted_payment_date),1)]),"cell-payment_number":a(({row:e})=>[n(ue,{to:{path:`payments/${e.data.id}/view`},class:"font-medium text-primary-500"},{default:a(()=>[p(c(e.data.payment_number),1)]),_:2},1032,["to"])]),"cell-name":a(({row:e})=>[n(ie,{text:e.data.customer.name,length:30,tag:"span"},null,8,["text"])]),"cell-payment_mode":a(({row:e})=>[y("span",null,c(e.data.payment_method?e.data.payment_method.name:"-"),1)]),"cell-invoice_number":a(({row:e})=>{var k,U,Y,H;return[y("span",null,c((U=(k=e==null?void 0:e.data)==null?void 0:k.invoice)!=null&&U.invoice_number?(H=(Y=e==null?void 0:e.data)==null?void 0:Y.invoice)==null?void 0:H.invoice_number:"-"),1)]}),"cell-amount":a(({row:e})=>[n(ce,{amount:e.data.amount,currency:e.data.customer.currency},null,8,["amount","currency"])]),_:2},[O()?{name:"cell-actions",fn:a(({row:e})=>[n(Ie,{row:e.data,table:i(h)},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[W,!M.value]])]),_:1})}}};export{Ye as default};
